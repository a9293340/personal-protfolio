<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AudioManager éŸ³æ•ˆç³»çµ±æ¸¬è©¦</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0a0a0a, #1a1a2e, #16213e);
      color: #e0e0e0;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      padding: 30px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
    }

    .title {
      font-size: 2.5em;
      color: #d4af37;
      margin: 0;
      text-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
    }

    .subtitle {
      font-size: 1.1em;
      color: #b0b0b0;
      margin: 10px 0 0 0;
    }

    .test-section {
      margin-bottom: 30px;
      padding: 25px;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .section-title {
      font-size: 1.4em;
      color: #4a9eff;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-icon {
      width: 24px;
      height: 24px;
      fill: currentColor;
    }

    .controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .control-group {
      background: rgba(255, 255, 255, 0.03);
      padding: 15px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .control-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #c0c0c0;
    }

    button {
      background: linear-gradient(45deg, #2980b9, #3498db);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
      min-width: 120px;
    }

    button:hover {
      background: linear-gradient(45deg, #3498db, #5dade2);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
    }

    button:active {
      transform: translateY(0);
    }

    button.danger {
      background: linear-gradient(45deg, #c0392b, #e74c3c);
    }

    button.danger:hover {
      background: linear-gradient(45deg, #e74c3c, #ec7063);
    }

    button.success {
      background: linear-gradient(45deg, #27ae60, #2ecc71);
    }

    button.success:hover {
      background: linear-gradient(45deg, #2ecc71, #58d68d);
    }

    button:disabled {
      background: #555;
      cursor: not-allowed;
      opacity: 0.6;
    }

    input[type="range"] {
      width: 100%;
      margin: 8px 0;
    }

    .volume-display {
      text-align: center;
      font-size: 0.9em;
      color: #d4af37;
      font-weight: bold;
    }

    .status-panel {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      padding: 15px;
      font-family: monospace;
      font-size: 13px;
      line-height: 1.4;
    }

    .status-item {
      margin: 5px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .status-key {
      color: #4a9eff;
    }

    .status-value {
      color: #d4af37;
      font-weight: bold;
    }

    .phase-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 10px;
    }

    .phase-button {
      position: relative;
      overflow: hidden;
    }

    .phase-button.active {
      background: linear-gradient(45deg, #d4af37, #f1c40f);
      animation: pulse 1.5s ease-in-out infinite alternate;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 5px rgba(212, 175, 55, 0.5); }
      100% { box-shadow: 0 0 20px rgba(212, 175, 55, 0.8), 0 0 30px rgba(212, 175, 55, 0.4); }
    }

    .ui-sounds {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .ui-sounds button {
      min-width: 100px;
      font-size: 13px;
      padding: 8px 15px;
    }

    .warning-message {
      background: rgba(255, 193, 7, 0.1);
      border: 1px solid rgba(255, 193, 7, 0.3);
      color: #ffc107;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      text-align: center;
    }

    .error-message {
      background: rgba(220, 53, 69, 0.1);
      border: 1px solid rgba(220, 53, 69, 0.3);
      color: #dc3545;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      
      .title {
        font-size: 2em;
      }

      .controls {
        grid-template-columns: 1fr;
      }

      .phase-buttons {
        grid-template-columns: 1fr 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1 class="title">ğŸµ AudioManager éŸ³æ•ˆç³»çµ±æ¸¬è©¦</h1>
      <p class="subtitle">éŠæˆ²ç‹å¬å–šç‰¹æ•ˆéŸ³æ•ˆç³»çµ±å®Œæ•´æ¸¬è©¦ç’°å¢ƒ</p>
    </div>

    <div id="warningMessage" class="warning-message" style="display: none;">
      âš ï¸ éœ€è¦ç”¨æˆ¶äº’å‹•æ‰èƒ½å•Ÿå‹•éŸ³æ•ˆç³»çµ±ã€‚è«‹é»æ“Šä»»ä½•æŒ‰éˆ•é–‹å§‹æ¸¬è©¦ã€‚
    </div>

    <div id="errorMessage" class="error-message" style="display: none;"></div>

    <!-- ç³»çµ±ç‹€æ…‹ -->
    <div class="test-section">
      <h3 class="section-title">
        ğŸ“Š ç³»çµ±ç‹€æ…‹ç›£æ§
      </h3>
      <div id="statusPanel" class="status-panel">
        <div class="status-item">
          <span class="status-key">åˆå§‹åŒ–ç‹€æ…‹:</span>
          <span id="initStatus" class="status-value">æœªåˆå§‹åŒ–</span>
        </div>
        <div class="status-item">
          <span class="status-key">AudioContext:</span>
          <span id="contextStatus" class="status-value">æš«åœ</span>
        </div>
        <div class="status-item">
          <span class="status-key">éŸ³æ•ˆå•Ÿç”¨:</span>
          <span id="enabledStatus" class="status-value">æ˜¯</span>
        </div>
        <div class="status-item">
          <span class="status-key">ç•¶å‰éšæ®µ:</span>
          <span id="currentPhase" class="status-value">ç„¡</span>
        </div>
        <div class="status-item">
          <span class="status-key">æ´»èºéŸ³æ•ˆ:</span>
          <span id="activeSounds" class="status-value">0</span>
        </div>
        <div class="status-item">
          <span class="status-key">è¨­å‚™æ€§èƒ½:</span>
          <span id="deviceCapability" class="status-value">æœªçŸ¥</span>
        </div>
      </div>
    </div>

    <!-- ç³»çµ±æ§åˆ¶ -->
    <div class="test-section">
      <h3 class="section-title">
        ğŸ›ï¸ ç³»çµ±æ§åˆ¶
      </h3>
      <div class="controls">
        <div class="control-group">
          <button id="initBtn" onclick="initAudioManager()">åˆå§‹åŒ–éŸ³æ•ˆç³»çµ±</button>
        </div>
        <div class="control-group">
          <button id="enableBtn" onclick="toggleAudioEnabled()" class="success">å•Ÿç”¨éŸ³æ•ˆ</button>
        </div>
        <div class="control-group">
          <button onclick="stopAllSounds()" class="danger">åœæ­¢æ‰€æœ‰éŸ³æ•ˆ</button>
        </div>
        <div class="control-group">
          <button onclick="getAudioStatus()">åˆ·æ–°ç‹€æ…‹</button>
        </div>
      </div>
    </div>

    <!-- éŸ³é‡æ§åˆ¶ -->
    <div class="test-section">
      <h3 class="section-title">
        ğŸ”Š éŸ³é‡æ§åˆ¶
      </h3>
      <div class="controls">
        <div class="control-group">
          <label class="control-label">ä¸»éŸ³é‡</label>
          <input type="range" id="masterVolume" min="0" max="1" step="0.1" value="0.7" 
                 oninput="setVolume('master', this.value)">
          <div id="masterVolumeDisplay" class="volume-display">70%</div>
        </div>
        <div class="control-group">
          <label class="control-label">éŸ³æ•ˆéŸ³é‡</label>
          <input type="range" id="sfxVolume" min="0" max="1" step="0.1" value="0.8" 
                 oninput="setVolume('sfx', this.value)">
          <div id="sfxVolumeDisplay" class="volume-display">80%</div>
        </div>
        <div class="control-group">
          <label class="control-label">èƒŒæ™¯éŸ³é‡</label>
          <input type="range" id="bgmVolume" min="0" max="1" step="0.1" value="0.5" 
                 oninput="setVolume('bgm', this.value)">
          <div id="bgmVolumeDisplay" class="volume-display">50%</div>
        </div>
        <div class="control-group">
          <label class="control-label">UI éŸ³é‡</label>
          <input type="range" id="uiVolume" min="0" max="1" step="0.1" value="0.6" 
                 oninput="setVolume('ui', this.value)">
          <div id="uiVolumeDisplay" class="volume-display">60%</div>
        </div>
      </div>
    </div>

    <!-- å¬å–šéšæ®µéŸ³æ•ˆæ¸¬è©¦ -->
    <div class="test-section">
      <h3 class="section-title">
        âš¡ å¬å–šéšæ®µéŸ³æ•ˆæ¸¬è©¦
      </h3>
      <div class="phase-buttons">
        <button id="magicCircleBtn" onclick="playPhaseSound('magicCircle')" class="phase-button">
          ğŸ”® é­”æ³•é™£å±•é–‹ (2s)
        </button>
        <button id="energyGatherBtn" onclick="playPhaseSound('energyGather')" class="phase-button">
          ğŸ’« èƒ½é‡èšé›† (1.5s)
        </button>
        <button id="particleBurstBtn" onclick="playPhaseSound('particleBurst')" class="phase-button">
          âœ¨ ç²’å­çˆ†ç™¼ (1s)
        </button>
        <button id="cardSummoningBtn" onclick="playPhaseSound('cardSummoning')" class="phase-button">
          ğŸƒ å¡ç‰Œå¬å–š (3.5s)
        </button>
        <button id="transitionBtn" onclick="playPhaseSound('transition')" class="phase-button">
          ğŸŒ€ è½‰å ´æº–å‚™ (0.5s)
        </button>
        <button onclick="playFullSequence()" class="success">
          ğŸ¬ å®Œæ•´åºåˆ—æ’­æ”¾ (8ç§’)
        </button>
      </div>
    </div>

    <!-- UI éŸ³æ•ˆæ¸¬è©¦ -->
    <div class="test-section">
      <h3 class="section-title">
        ğŸ–±ï¸ UI éŸ³æ•ˆæ¸¬è©¦
      </h3>
      <div class="ui-sounds">
        <button onclick="playUISound('click')">é»æ“ŠéŸ³æ•ˆ</button>
        <button onclick="playUISound('hover')">æ‡¸åœéŸ³æ•ˆ</button>
        <button onclick="playUISound('error')">éŒ¯èª¤éŸ³æ•ˆ</button>
        <button onclick="playUISound('success')">æˆåŠŸéŸ³æ•ˆ</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { AudioManager } from './src/components/gaming/SummoningSystem/AudioManager.js';

    let audioManager = null;
    let isInitialized = false;

    // ç¶å®šå…¨åŸŸå‡½æ•¸
    window.initAudioManager = initAudioManager;
    window.toggleAudioEnabled = toggleAudioEnabled;
    window.stopAllSounds = stopAllSounds;
    window.getAudioStatus = getAudioStatus;
    window.setVolume = setVolume;
    window.playPhaseSound = playPhaseSound;
    window.playUISound = playUISound;
    window.playFullSequence = playFullSequence;

    // åˆå§‹åŒ–é¡¯ç¤º
    updateUI();
    showWarning();

    async function initAudioManager() {
      try {
        showMessage('æ­£åœ¨åˆå§‹åŒ– AudioManager...', 'info');
        
        audioManager = new AudioManager('audio-test-container', {
          enabled: true,
          masterVolume: 0.7,
          enableSummoningSounds: true,
          enableUISounds: true
        });

        // ç›£è½äº‹ä»¶
        audioManager.on('audioManagerReady', (data) => {
          console.log('AudioManager ready:', data);
          showMessage('AudioManager åˆå§‹åŒ–å®Œæˆï¼', 'success');
          hideWarning();
          updateUI();
        });

        audioManager.on('phaseAudioStart', (data) => {
          console.log('Phase audio started:', data);
          highlightPhaseButton(data.phase, true);
        });

        audioManager.on('phaseAudioEnd', (data) => {
          console.log('Phase audio ended:', data);
          highlightPhaseButton(data.phase, false);
          updateUI();
        });

        audioManager.on('audioContextResumed', () => {
          console.log('AudioContext resumed');
          updateUI();
        });

        audioManager.on('volumeChanged', (data) => {
          console.log('Volume changed:', data);
          updateVolumeDisplay(data.type, data.value);
        });

        await audioManager.init();
        isInitialized = true;
        
        // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
        document.getElementById('initBtn').textContent = 'é‡æ–°åˆå§‹åŒ–';
        document.getElementById('initBtn').disabled = false;

      } catch (error) {
        console.error('Failed to initialize AudioManager:', error);
        showMessage(`åˆå§‹åŒ–å¤±æ•—: ${error.message}`, 'error');
      }
    }

    function toggleAudioEnabled() {
      if (!audioManager) return;
      
      const newState = !audioManager.isEnabled;
      audioManager.setEnabled(newState);
      
      const btn = document.getElementById('enableBtn');
      btn.textContent = newState ? 'ç¦ç”¨éŸ³æ•ˆ' : 'å•Ÿç”¨éŸ³æ•ˆ';
      btn.className = newState ? 'danger' : 'success';
      
      updateUI();
    }

    function stopAllSounds() {
      if (!audioManager) return;
      
      audioManager.pauseAllSounds();
      
      // æ¸…é™¤æ‰€æœ‰é«˜äº®
      document.querySelectorAll('.phase-button.active').forEach(btn => {
        btn.classList.remove('active');
      });
      
      showMessage('å·²åœæ­¢æ‰€æœ‰éŸ³æ•ˆ', 'info');
      updateUI();
    }

    function getAudioStatus() {
      if (!audioManager) return;
      
      const status = audioManager.getAudioStatus();
      console.log('Audio Status:', status);
      updateUI();
      showMessage('ç‹€æ…‹å·²åˆ·æ–°', 'info');
    }

    function setVolume(type, value) {
      if (!audioManager) return;
      
      audioManager.setVolume(type, parseFloat(value));
      updateVolumeDisplay(type, value);
    }

    async function playPhaseSound(phase) {
      if (!audioManager) {
        showMessage('è«‹å…ˆåˆå§‹åŒ– AudioManager', 'error');
        return;
      }
      
      try {
        await audioManager.playPhaseSound(phase);
        updateUI();
      } catch (error) {
        console.error('Failed to play phase sound:', error);
        showMessage(`æ’­æ”¾å¤±æ•—: ${error.message}`, 'error');
      }
    }

    async function playUISound(type) {
      if (!audioManager) {
        showMessage('è«‹å…ˆåˆå§‹åŒ– AudioManager', 'error');
        return;
      }
      
      try {
        await audioManager.playUISound(type);
      } catch (error) {
        console.error('Failed to play UI sound:', error);
        showMessage(`æ’­æ”¾å¤±æ•—: ${error.message}`, 'error');
      }
    }

    async function playFullSequence() {
      if (!audioManager) {
        showMessage('è«‹å…ˆåˆå§‹åŒ– AudioManager', 'error');
        return;
      }
      
      try {
        showMessage('é–‹å§‹æ’­æ”¾å®Œæ•´å¬å–šåºåˆ— (8ç§’)...', 'info');
        
        // æŒ‰ç…§æ™‚åºæ’­æ”¾å„éšæ®µ
        setTimeout(() => playPhaseSound('magicCircle'), 0);
        setTimeout(() => playPhaseSound('energyGather'), 2000);
        setTimeout(() => playPhaseSound('particleBurst'), 3500);
        setTimeout(() => playPhaseSound('cardSummoning'), 4500);
        setTimeout(() => playPhaseSound('transition'), 8000);
        
        setTimeout(() => {
          showMessage('å®Œæ•´å¬å–šåºåˆ—æ’­æ”¾å®Œæˆï¼', 'success');
        }, 8500);
        
      } catch (error) {
        console.error('Failed to play full sequence:', error);
        showMessage(`åºåˆ—æ’­æ”¾å¤±æ•—: ${error.message}`, 'error');
      }
    }

    function updateUI() {
      if (!audioManager) {
        document.getElementById('initStatus').textContent = 'æœªåˆå§‹åŒ–';
        document.getElementById('contextStatus').textContent = 'ä¸å¯ç”¨';
        document.getElementById('enabledStatus').textContent = 'ä¸å¯ç”¨';
        document.getElementById('currentPhase').textContent = 'ç„¡';
        document.getElementById('activeSounds').textContent = '0';
        document.getElementById('deviceCapability').textContent = 'æœªçŸ¥';
        return;
      }
      
      const status = audioManager.getAudioStatus();
      
      document.getElementById('initStatus').textContent = status.isInitialized ? 'å·²åˆå§‹åŒ–' : 'æœªåˆå§‹åŒ–';
      document.getElementById('contextStatus').textContent = 
        status.audioContextState === 'running' ? 'é‹è¡Œä¸­' : 
        status.audioContextState === 'suspended' ? 'æš«åœ' : 
        status.audioContextState;
      document.getElementById('enabledStatus').textContent = status.isEnabled ? 'æ˜¯' : 'å¦';
      document.getElementById('currentPhase').textContent = audioManager.state.currentPhase || 'ç„¡';
      document.getElementById('activeSounds').textContent = status.activeSoundsCount;
      
      const capability = status.deviceCapability;
      if (typeof capability === 'object') {
        document.getElementById('deviceCapability').textContent = capability.performance || 'æœªçŸ¥';
      } else {
        document.getElementById('deviceCapability').textContent = 'æœªçŸ¥';
      }
    }

    function updateVolumeDisplay(type, value) {
      const percentage = Math.round(value * 100);
      const displayId = `${type}VolumeDisplay`;
      const displayElement = document.getElementById(displayId);
      if (displayElement) {
        displayElement.textContent = `${percentage}%`;
      }
    }

    function highlightPhaseButton(phase, active) {
      const btnId = `${phase}Btn`;
      const btn = document.getElementById(btnId);
      if (btn) {
        if (active) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      }
    }

    function showWarning() {
      document.getElementById('warningMessage').style.display = 'block';
    }

    function hideWarning() {
      document.getElementById('warningMessage').style.display = 'none';
    }

    function showMessage(message, type = 'info') {
      console.log(`[${type.toUpperCase()}] ${message}`);
      
      if (type === 'error') {
        const errorDiv = document.getElementById('errorMessage');
        errorDiv.textContent = message;
        errorDiv.style.display = 'block';
        setTimeout(() => {
          errorDiv.style.display = 'none';
        }, 5000);
      }
    }

    // å®šæœŸæ›´æ–°ç‹€æ…‹
    setInterval(updateUI, 1000);
  </script>
</body>
</html>
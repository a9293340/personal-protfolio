<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MagicCircle é­”æ³•é™£çµ„ä»¶æ¸¬è©¦</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
      color: #fff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .test-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .control-panel {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 15px;
      z-index: 2000;
    }

    .test-btn {
      background: linear-gradient(135deg, #d4af37, #f4d03f);
      color: #0a0a0a;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
    }

    .test-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
    }

    .test-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .status-info {
      position: fixed;
      top: 80px;
      left: 20px;
      background: rgba(0, 0, 0, 0.7);
      padding: 15px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 12px;
      z-index: 2000;
      max-width: 300px;
    }

    .status-info h3 {
      color: #d4af37;
      margin-bottom: 10px;
    }

    .status-item {
      margin: 5px 0;
    }

    .status-value {
      color: #4a90e2;
      font-weight: bold;
    }

    #magic-circle-display {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: visible;
    }
    
    /* ç¢ºä¿é­”æ³•é™£å®¹å™¨ä¸è¢«è£å‰ª */
    .magic-circle-container {
      overflow: visible !important;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="control-panel">
      <button id="expand-btn" class="test-btn">å±•é–‹é­”æ³•é™£</button>
      <button id="collapse-btn" class="test-btn" disabled>æ”¶ç¸®é­”æ³•é™£</button>
      <button id="reset-btn" class="test-btn">é‡ç½®ç‹€æ…‹</button>
    </div>

    <!-- ç‹€æ…‹ä¿¡æ¯ -->
    <div class="status-info">
      <h3>ğŸ”® é­”æ³•é™£ç‹€æ…‹</h3>
      <div class="status-item">
        éšæ®µ: <span id="phase-status" class="status-value">idle</span>
      </div>
      <div class="status-item">
        å¯è¦‹æ€§: <span id="visibility-status" class="status-value">false</span>
      </div>
      <div class="status-item">
        ç¬¦æ–‡æ•¸é‡: <span id="runes-status" class="status-value">0/6</span>
      </div>
      <div class="status-item">
        å‹•ç•«ç‹€æ…‹: <span id="animation-status" class="status-value">åœæ­¢</span>
      </div>
    </div>

    <!-- é­”æ³•é™£é¡¯ç¤ºå€åŸŸ -->
    <div id="magic-circle-display"></div>
  </div>

  <!-- GSAP åº« -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

  <!-- æ¸¬è©¦è…³æœ¬ -->
  <script type="module">
    // å°å…¥å¿…è¦çš„çµ„ä»¶
    import { BaseComponent } from './src/core/components/BaseComponent.js';
    import { MagicCircle } from './src/components/gaming/SummoningSystem/MagicCircle.js';

    class MagicCircleTest {
      constructor() {
        this.magicCircle = null;
        this.init();
      }

      async init() {
        console.log('ğŸ§ª [MagicCircleTest] åˆå§‹åŒ–é­”æ³•é™£æ¸¬è©¦');
        
        try {
          // å‰µå»ºé­”æ³•é™£å¯¦ä¾‹
          this.magicCircle = new MagicCircle({
            circle: {
              size: 400,
              color: '#d4af37',
              glowColor: '#f4d03f'
            },
            position: {
              x: '50%',
              y: '50%'
            }
          });

          // åˆå§‹åŒ–çµ„ä»¶
          await this.magicCircle.init();

          // å‰µå»ºå…ƒç´ ä¸¦æ·»åŠ åˆ°é é¢
          const element = this.magicCircle.createElement();
          document.getElementById('magic-circle-display').appendChild(element);

          // ç¶å®šæ§åˆ¶æŒ‰éˆ•äº‹ä»¶
          this.bindEvents();

          // é–‹å§‹ç‹€æ…‹ç›£æ§
          this.startStatusMonitoring();

          console.log('âœ… [MagicCircleTest] æ¸¬è©¦ç’°å¢ƒæº–å‚™å®Œæˆ');

        } catch (error) {
          console.error('âŒ [MagicCircleTest] åˆå§‹åŒ–å¤±æ•—:', error);
          alert('æ¸¬è©¦åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹æª¢æŸ¥æ§åˆ¶å°éŒ¯èª¤ä¿¡æ¯');
        }
      }

      bindEvents() {
        const expandBtn = document.getElementById('expand-btn');
        const collapseBtn = document.getElementById('collapse-btn');
        const resetBtn = document.getElementById('reset-btn');

        expandBtn.addEventListener('click', async () => {
          console.log('ğŸ”¥ [Test] ç”¨æˆ¶é»æ“Šå±•é–‹æŒ‰éˆ•');
          expandBtn.disabled = true;
          
          try {
            await this.magicCircle.expand();
            collapseBtn.disabled = false;
          } catch (error) {
            console.error('å±•é–‹å‹•ç•«å¤±æ•—:', error);
          } finally {
            expandBtn.disabled = false;
          }
        });

        collapseBtn.addEventListener('click', async () => {
          console.log('ğŸ’¨ [Test] ç”¨æˆ¶é»æ“Šæ”¶ç¸®æŒ‰éˆ•');
          collapseBtn.disabled = true;
          
          try {
            await this.magicCircle.collapse();
            expandBtn.disabled = false;
          } catch (error) {
            console.error('æ”¶ç¸®å‹•ç•«å¤±æ•—:', error);
          } finally {
            collapseBtn.disabled = false;
          }
        });

        resetBtn.addEventListener('click', () => {
          console.log('ğŸ”„ [Test] ç”¨æˆ¶é»æ“Šé‡ç½®æŒ‰éˆ•');
          this.magicCircle.reset();
          expandBtn.disabled = false;
          collapseBtn.disabled = true;
        });
      }

      startStatusMonitoring() {
        const updateStatus = () => {
          if (!this.magicCircle) return;

          const state = this.magicCircle.state;
          
          // æ›´æ–°ç‹€æ…‹é¡¯ç¤º
          document.getElementById('phase-status').textContent = state.currentPhase;
          document.getElementById('visibility-status').textContent = state.isVisible ? 'true' : 'false';
          document.getElementById('runes-status').textContent = `${state.runesActivated}/6`;
          document.getElementById('animation-status').textContent = this.magicCircle.isAnimating ? 'é‹è¡Œä¸­' : 'åœæ­¢';
        };

        // æ¯500msæ›´æ–°ä¸€æ¬¡ç‹€æ…‹
        setInterval(updateStatus, 500);
      }
    }

    // ç­‰å¾…é é¢è¼‰å…¥å®Œæˆå¾Œå•Ÿå‹•æ¸¬è©¦
    document.addEventListener('DOMContentLoaded', () => {
      new MagicCircleTest();
    });
  </script>
</body>
</html>
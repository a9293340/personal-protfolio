<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ€èƒ½æ¨¹éŸ¿æ‡‰å¼æ¸¬è©¦ - Step 2.1.5</title>
    
    <style>
        :root {
            /* åŸºç¤è‰²å½© */
            --primary-dark: #0a0a0a;
            --secondary-dark: #1a1a2e;
            --primary-gold: #d4af37;
            --bright-gold: #f4d03f;
            --primary-blue: #2980b9;
            --skill-locked-color: #555;
            --skill-available-color: #3498db;
            --skill-mastered-color: #f4d03f;
            
            /* éŸ¿æ‡‰å¼è®Šæ•¸ */
            --skill-size: 60px;
            --skill-spacing: 120px;
            --layout-transition-duration: 400ms;
            
            /* éŸ¿æ‡‰å¼æ–·é» */
            --mobile: 768px;
            --tablet: 1024px;
            --desktop: 1200px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--secondary-dark) 100%);
            color: white;
            overflow-x: hidden;
        }
        
        /* æ¸¬è©¦æ§åˆ¶é¢æ¿ */
        .test-controls {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: rgba(26, 26, 46, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid var(--primary-gold);
            border-radius: 8px;
            padding: 15px;
            min-width: 280px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .test-controls h3 {
            color: var(--bright-gold);
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 12px;
            color: #ccc;
        }
        
        .control-group button {
            width: 100%;
            padding: 8px;
            margin-bottom: 5px;
            background: var(--primary-blue);
            border: none;
            border-radius: 4px;
            color: white;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .control-group button:hover {
            background: var(--bright-gold);
            transform: translateY(-1px);
        }
        
        .control-group button.active {
            background: var(--bright-gold);
            color: var(--primary-dark);
            font-weight: bold;
        }
        
        .stats-display {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 4px;
            font-size: 11px;
            line-height: 1.4;
        }
        
        /* æŠ€èƒ½æ¨¹å®¹å™¨ */
        .skill-tree-container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            cursor: grab;
        }
        
        .skill-tree-container.dragging {
            cursor: grabbing;
        }
        
        .skill-tree-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform-origin: 0 0;
            will-change: transform;
        }
        
        /* æŠ€èƒ½ç¯€é» */
        .skill-node {
            position: absolute;
            width: var(--skill-size);
            height: var(--skill-size);
            border-radius: 50%;
            border: 3px solid var(--skill-locked-color);
            background: radial-gradient(circle, rgba(255,255,255,0.1), rgba(0,0,0,0.3));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            transition: all var(--layout-transition-duration) ease;
            cursor: pointer;
            user-select: none;
            opacity: 0.4;
        }
        
        .skill-node:hover {
            transform: scale(1.1);
            z-index: 10;
        }
        
        .skill-node.skill-status-available {
            border-color: var(--skill-available-color);
            opacity: 0.8;
            box-shadow: 0 0 15px rgba(52, 152, 219, 0.4);
        }
        
        .skill-node.skill-status-mastered {
            border-color: var(--skill-mastered-color);
            opacity: 1.0;
            box-shadow: 0 0 20px rgba(244, 208, 63, 0.6);
        }
        
        .skill-node.skill-status-learning {
            border-color: #2ecc71;
            opacity: 0.7;
            box-shadow: 0 0 15px rgba(46, 204, 113, 0.4);
        }
        
        /* æŠ€èƒ½é€£æ¥ç·š */
        .skill-connection {
            position: absolute;
            background: linear-gradient(90deg, transparent, var(--primary-blue), transparent);
            height: 2px;
            opacity: 0.3;
            transition: all var(--layout-transition-duration) ease;
        }
        
        .skill-connection.simplified {
            opacity: 0.2;
            height: 1px;
        }
        
        /* åˆ†æ”¯é ­éƒ¨ */
        .skill-branch-header {
            position: absolute;
            background: rgba(26, 26, 46, 0.8);
            border: 1px solid var(--primary-gold);
            border-radius: 8px;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all var(--layout-transition-duration) ease;
            backdrop-filter: blur(5px);
        }
        
        .skill-branch-header h3 {
            color: var(--bright-gold);
            font-size: 14px;
            margin: 0;
        }
        
        .skill-branch-header .skill-count {
            color: #ccc;
            font-size: 12px;
        }
        
        .collapse-toggle {
            background: none;
            border: 1px solid var(--primary-gold);
            color: var(--bright-gold);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }
        
        .collapse-toggle:hover {
            background: var(--primary-gold);
            color: var(--primary-dark);
            transform: scale(1.1);
        }
        
        /* æŠ˜ç–Šç‹€æ…‹ */
        .skill-node.collapsed {
            opacity: 0 !important;
            transform: scale(0.8) translateY(-20px) !important;
            pointer-events: none;
        }
        
        /* éŸ¿æ‡‰å¼ä½ˆå±€æ¨¡å¼ */
        .skill-tree-container.layout-free-drag {
            /* è‡ªç”±æ‹–æ›³æ¨¡å¼ï¼ˆæ¡Œé¢ï¼‰ */
        }
        
        .skill-tree-container.layout-constrained {
            /* é™åˆ¶æ‹–æ›³æ¨¡å¼ï¼ˆå¹³æ¿ï¼‰ */
        }
        
        .skill-tree-container.layout-vertical {
            /* å‚ç›´æ»¾å‹•æ¨¡å¼ï¼ˆæ‰‹æ©Ÿï¼‰ */
            overflow-y: auto;
            overflow-x: hidden;
            cursor: default;
        }
        
        .layout-vertical .skill-tree-content {
            position: relative;
            height: auto;
        }
        
        .layout-vertical .skill-connection {
            display: none;
        }
        
        /* æ»¾å‹•æŒ‡ç¤ºå™¨ */
        .scroll-indicator {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(244, 208, 63, 0.9);
            color: var(--primary-dark);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            z-index: 100;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        /* éŸ¿æ‡‰å¼æ¨£å¼ */
        @media (max-width: 768px) {
            :root {
                --skill-size: 45px;
                --skill-spacing: 80px;
            }
            
            .test-controls {
                position: relative;
                width: 100%;
                max-height: none;
                margin-bottom: 10px;
            }
            
            .skill-tree-container {
                height: calc(100vh - 200px);
            }
            
            .skill-node {
                font-size: 10px;
            }
        }
        
        @media (min-width: 769px) and (max-width: 1024px) {
            :root {
                --skill-size: 50px;
                --skill-spacing: 100px;
            }
        }
        
        @media (min-width: 1025px) {
            :root {
                --skill-size: 60px;
                --skill-spacing: 120px;
            }
        }
        
        /* è§¸æ§å‹å¥½ */
        @media (hover: none) {
            .skill-node:hover {
                transform: none;
            }
            
            .skill-node:active {
                transform: scale(0.95);
            }
            
            .collapse-toggle:hover {
                transform: none;
                background: var(--primary-gold);
            }
            
            .collapse-toggle:active {
                transform: scale(0.9);
            }
        }
        
        /* é«˜å°æ¯”åº¦æ”¯æ´ */
        @media (prefers-contrast: high) {
            .skill-node {
                border-width: 4px;
            }
            
            .skill-connection {
                opacity: 0.8;
                height: 3px;
            }
        }
        
        /* æ¸›å°‘å‹•ç•« */
        @media (prefers-reduced-motion: reduce) {
            * {
                transition: none !important;
                animation: none !important;
            }
            
            :root {
                --layout-transition-duration: 0ms;
            }
        }
    </style>
</head>
<body>
    <!-- æ¸¬è©¦æ§åˆ¶é¢æ¿ -->
    <div class="test-controls">
        <h3>ğŸ“± éŸ¿æ‡‰å¼æ¸¬è©¦æ§åˆ¶</h3>
        
        <div class="control-group">
            <label>ä½ˆå±€æ¨¡å¼</label>
            <button id="layout-desktop" class="active">ğŸ–¥ï¸ æ¡Œé¢ç«¯ (è‡ªç”±æ‹–æ›³)</button>
            <button id="layout-tablet">ğŸ“± å¹³æ¿ (é™åˆ¶æ‹–æ›³)</button>
            <button id="layout-mobile">ğŸ“± æ‰‹æ©Ÿ (å‚ç›´æ»¾å‹•)</button>
        </div>
        
        <div class="control-group">
            <label>è¦–çª—æ§åˆ¶</label>
            <button id="viewport-reset">ğŸ¯ é‡ç½®è¦–çª—</button>
            <button id="viewport-center">ğŸ“ å±…ä¸­é¡¯ç¤º</button>
            <button id="zoom-in">ğŸ”+ æ”¾å¤§</button>
            <button id="zoom-out">ğŸ”- ç¸®å°</button>
        </div>
        
        <div class="control-group">
            <label>åˆ†æ”¯æ§åˆ¶ (æ‰‹æ©Ÿæ¨¡å¼)</label>
            <button id="expand-all">ğŸ“‚ å±•é–‹æ‰€æœ‰åˆ†æ”¯</button>
            <button id="collapse-all">ğŸ“ æŠ˜ç–Šæ‰€æœ‰åˆ†æ”¯</button>
            <button id="toggle-frontend">ğŸ¨ åˆ‡æ›å‰ç«¯åˆ†æ”¯</button>
            <button id="toggle-backend">âš™ï¸ åˆ‡æ›å¾Œç«¯åˆ†æ”¯</button>
        </div>
        
        <div class="control-group">
            <label>æ¸¬è©¦å·¥å…·</label>
            <button id="simulate-mobile">ğŸ“± æ¨¡æ“¬ç§»å‹•ç«¯</button>
            <button id="simulate-tablet">ğŸ’» æ¨¡æ“¬å¹³æ¿ç«¯</button>
            <button id="simulate-desktop">ğŸ–¥ï¸ æ¨¡æ“¬æ¡Œé¢ç«¯</button>
            <button id="test-performance">âš¡ æ•ˆèƒ½æ¸¬è©¦</button>
        </div>
        
        <div class="stats-display" id="stats-display">
            <div>ğŸ“Š <strong>ç³»çµ±ç‹€æ…‹</strong></div>
            <div id="device-info">è¨­å‚™: è¼‰å…¥ä¸­...</div>
            <div id="viewport-info">è¦–çª—: è¼‰å…¥ä¸­...</div>
            <div id="layout-info">ä½ˆå±€: è¼‰å…¥ä¸­...</div>
            <div id="interaction-info">äº’å‹•: è¼‰å…¥ä¸­...</div>
            <div id="performance-info">æ•ˆèƒ½: è¼‰å…¥ä¸­...</div>
        </div>
    </div>

    <!-- æŠ€èƒ½æ¨¹å®¹å™¨ -->
    <div class="skill-tree-container" id="skill-tree-container">
        <div class="skill-tree-content" id="skill-tree-content">
            <!-- æŠ€èƒ½ç¯€é»å°‡ç”± JavaScript å‹•æ…‹å‰µå»º -->
        </div>
    </div>

    <script type="module">
        // å°å…¥å¿…è¦æ¨¡çµ„
        import SkillTreeViewportController from './src/components/gaming/SkillTree/SkillTreeViewportController.js';
        import SkillTreeResponsiveAdapter from './src/components/gaming/SkillTree/SkillTreeResponsiveAdapter.js';
        import SkillTreeStateManager from './src/components/gaming/SkillTree/SkillStateManager.js';
        
        /**
         * éŸ¿æ‡‰å¼æŠ€èƒ½æ¨¹æ¸¬è©¦æ‡‰ç”¨
         */
        class ResponsiveSkillTreeTest {
            constructor() {
                this.container = document.getElementById('skill-tree-container');
                this.content = document.getElementById('skill-tree-content');
                
                // æ§åˆ¶å™¨å¯¦ä¾‹
                this.viewportController = null;
                this.responsiveAdapter = null;
                this.stateManager = null;
                
                // æ¸¬è©¦æ•¸æ“š
                this.testSkills = this.generateTestSkills();
                this.currentMode = 'desktop';
                
                // çµ±è¨ˆä¿¡æ¯
                this.stats = {
                    frameRate: 0,
                    interactionCount: 0,
                    layoutSwitchCount: 0,
                    startTime: Date.now()
                };
                
                this.init();
            }
            
            async init() {
                console.log('ResponsiveSkillTreeTest: åˆå§‹åŒ–éŸ¿æ‡‰å¼æ¸¬è©¦');
                
                // å‰µå»ºæ¸¬è©¦æŠ€èƒ½ç¯€é»
                this.createTestSkills();
                
                // åˆå§‹åŒ–æ§åˆ¶å™¨
                await this.initializeControllers();
                
                // ç¶å®šæ¸¬è©¦æ§åˆ¶
                this.bindTestControls();
                
                // é–‹å§‹çµ±è¨ˆæ›´æ–°
                this.startStatsUpdate();
                
                // åˆå§‹ç‹€æ…‹é¡¯ç¤º
                this.updateStatsDisplay();
                
                console.log('ResponsiveSkillTreeTest: åˆå§‹åŒ–å®Œæˆ');
            }
            
            generateTestSkills() {
                return [
                    // å‰ç«¯åˆ†æ”¯
                    { id: 'html-basics', name: 'HTML', branch: 'frontend', x: 0, y: 0, status: 'mastered' },
                    { id: 'css-fundamentals', name: 'CSS', branch: 'frontend', x: 100, y: -50, status: 'mastered' },
                    { id: 'javascript-core', name: 'JavaScript', branch: 'frontend', x: 200, y: 0, status: 'available' },
                    { id: 'react-basics', name: 'React', branch: 'frontend', x: 300, y: -50, status: 'available' },
                    { id: 'vue-framework', name: 'Vue.js', branch: 'frontend', x: 300, y: 50, status: 'locked' },
                    
                    // å¾Œç«¯åˆ†æ”¯
                    { id: 'nodejs-runtime', name: 'Node.js', branch: 'backend', x: 0, y: 150, status: 'mastered' },
                    { id: 'express-framework', name: 'Express', branch: 'backend', x: 100, y: 200, status: 'mastered' },
                    { id: 'fastify-framework', name: 'Fastify', branch: 'backend', x: 100, y: 100, status: 'available' },
                    { id: 'graphql-api', name: 'GraphQL', branch: 'backend', x: 200, y: 150, status: 'learning' },
                    { id: 'microservices', name: 'å¾®æœå‹™', branch: 'backend', x: 300, y: 150, status: 'locked' },
                    
                    // è³‡æ–™åº«åˆ†æ”¯
                    { id: 'sql-basics', name: 'SQL', branch: 'database', x: -100, y: 0, status: 'mastered' },
                    { id: 'postgresql-db', name: 'PostgreSQL', branch: 'database', x: -200, y: -50, status: 'mastered' },
                    { id: 'mongodb-nosql', name: 'MongoDB', branch: 'database', x: -200, y: 50, status: 'available' },
                    { id: 'redis-cache', name: 'Redis', branch: 'database', x: -300, y: 0, status: 'available' },
                    
                    // DevOps åˆ†æ”¯
                    { id: 'docker-containers', name: 'Docker', branch: 'devops', x: 0, y: -150, status: 'mastered' },
                    { id: 'kubernetes-orch', name: 'Kubernetes', branch: 'devops', x: 100, y: -200, status: 'learning' },
                    { id: 'aws-cloud', name: 'AWS', branch: 'devops', x: 200, y: -150, status: 'available' },
                    { id: 'terraform-iac', name: 'Terraform', branch: 'devops', x: 300, y: -200, status: 'locked' }
                ];
            }
            
            createTestSkills() {
                this.content.innerHTML = ''; // æ¸…ç©ºå…§å®¹
                
                this.testSkills.forEach(skill => {
                    const skillElement = document.createElement('div');
                    skillElement.className = `skill-node skill-status-${skill.status}`;
                    skillElement.dataset.skillId = skill.id;
                    skillElement.dataset.branch = skill.branch;
                    skillElement.textContent = skill.name;
                    
                    // è¨­ç½®åˆå§‹ä½ç½®ï¼ˆå±…ä¸­åç§»ï¼‰
                    const centerX = this.container.clientWidth / 2;
                    const centerY = this.container.clientHeight / 2;
                    skillElement.style.left = `${centerX + skill.x}px`;
                    skillElement.style.top = `${centerY + skill.y}px`;
                    
                    this.content.appendChild(skillElement);
                });
                
                // å‰µå»ºä¸€äº›é€£æ¥ç·šç”¨æ–¼æ¸¬è©¦
                this.createTestConnections();
            }
            
            createTestConnections() {
                const connections = [
                    { from: 'html-basics', to: 'css-fundamentals' },
                    { from: 'css-fundamentals', to: 'javascript-core' },
                    { from: 'javascript-core', to: 'react-basics' },
                    { from: 'javascript-core', to: 'vue-framework' },
                    { from: 'nodejs-runtime', to: 'express-framework' },
                    { from: 'nodejs-runtime', to: 'fastify-framework' },
                    { from: 'express-framework', to: 'graphql-api' },
                    { from: 'sql-basics', to: 'postgresql-db' },
                    { from: 'sql-basics', to: 'mongodb-nosql' }
                ];
                
                connections.forEach(conn => {
                    const fromEl = document.querySelector(`[data-skill-id="${conn.from}"]`);
                    const toEl = document.querySelector(`[data-skill-id="${conn.to}"]`);
                    
                    if (fromEl && toEl) {
                        const connection = document.createElement('div');
                        connection.className = 'skill-connection';
                        connection.dataset.from = conn.from;
                        connection.dataset.to = conn.to;
                        
                        // ç°¡å–®çš„é€£ç·šå®šä½ï¼ˆå¯¦éš›æ‡‰è©²æ›´ç²¾ç¢ºï¼‰
                        const fromRect = fromEl.getBoundingClientRect();
                        const toRect = toEl.getBoundingClientRect();
                        const containerRect = this.container.getBoundingClientRect();
                        
                        const x1 = fromRect.left - containerRect.left + fromRect.width / 2;
                        const y1 = fromRect.top - containerRect.top + fromRect.height / 2;
                        const x2 = toRect.left - containerRect.left + toRect.width / 2;
                        const y2 = toRect.top - containerRect.top + toRect.height / 2;
                        
                        const length = Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
                        const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
                        
                        connection.style.width = `${length}px`;
                        connection.style.left = `${x1}px`;
                        connection.style.top = `${y1}px`;
                        connection.style.transform = `rotate(${angle}deg)`;
                        connection.style.transformOrigin = '0 50%';
                        
                        this.content.appendChild(connection);
                    }
                });
            }
            
            async initializeControllers() {
                try {
                    // åˆå§‹åŒ–ç‹€æ…‹ç®¡ç†å™¨
                    this.stateManager = new SkillTreeStateManager();
                    
                    // åˆå§‹åŒ–è¦–çª—æ§åˆ¶å™¨
                    this.viewportController = new SkillTreeViewportController(this.container);
                    
                    // åˆå§‹åŒ–éŸ¿æ‡‰å¼é©é…å™¨
                    this.responsiveAdapter = new SkillTreeResponsiveAdapter(this.container);
                    
                    // ç¶å®šäº‹ä»¶
                    this.bindControllerEvents();
                    
                    console.log('ResponsiveSkillTreeTest: æ‰€æœ‰æ§åˆ¶å™¨åˆå§‹åŒ–å®Œæˆ');
                } catch (error) {
                    console.error('ResponsiveSkillTreeTest: æ§åˆ¶å™¨åˆå§‹åŒ–å¤±æ•—', error);
                }
            }
            
            bindControllerEvents() {
                // è¦–çª—æ§åˆ¶å™¨äº‹ä»¶
                this.viewportController.on('drag-start', () => {
                    this.container.classList.add('dragging');
                    this.stats.interactionCount++;
                });
                
                this.viewportController.on('drag-end', () => {
                    this.container.classList.remove('dragging');
                });
                
                this.viewportController.on('zoom-change', (data) => {
                    console.log('Zoom changed:', data.scale);
                });
                
                // éŸ¿æ‡‰å¼é©é…å™¨äº‹ä»¶
                this.responsiveAdapter.on('layout-applied', (data) => {
                    console.log('Layout applied:', data.mode);
                    this.stats.layoutSwitchCount++;
                    this.updateLayoutButtons(data.mode);
                });
                
                this.responsiveAdapter.on('branch-toggle', (data) => {
                    console.log('Branch toggled:', data.branch, data.collapsed);
                });
                
                this.responsiveAdapter.on('skill-tap', (data) => {
                    console.log('Skill tapped:', data.skillId);
                    this.stats.interactionCount++;
                });
            }
            
            bindTestControls() {
                // ä½ˆå±€æ¨¡å¼æ§åˆ¶
                document.getElementById('layout-desktop').addEventListener('click', () => {
                    this.switchLayout('desktop');
                });
                
                document.getElementById('layout-tablet').addEventListener('click', () => {
                    this.switchLayout('tablet');
                });
                
                document.getElementById('layout-mobile').addEventListener('click', () => {
                    this.switchLayout('mobile');
                });
                
                // è¦–çª—æ§åˆ¶
                document.getElementById('viewport-reset').addEventListener('click', () => {
                    this.viewportController.resetViewport();
                });
                
                document.getElementById('viewport-center').addEventListener('click', () => {
                    this.viewportController.centerViewport();
                });
                
                document.getElementById('zoom-in').addEventListener('click', () => {
                    this.viewportController.zoomAtPoint(
                        this.container.clientWidth / 2,
                        this.container.clientHeight / 2,
                        0.2
                    );
                });
                
                document.getElementById('zoom-out').addEventListener('click', () => {
                    this.viewportController.zoomAtPoint(
                        this.container.clientWidth / 2,
                        this.container.clientHeight / 2,
                        -0.2
                    );
                });
                
                // åˆ†æ”¯æ§åˆ¶
                document.getElementById('expand-all').addEventListener('click', () => {
                    this.responsiveAdapter.expandAllBranches();
                });
                
                document.getElementById('collapse-all').addEventListener('click', () => {
                    ['frontend', 'backend', 'database', 'devops'].forEach(branch => {
                        this.responsiveAdapter.toggleBranchCollapse(branch);
                    });
                });
                
                document.getElementById('toggle-frontend').addEventListener('click', () => {
                    this.responsiveAdapter.toggleBranchCollapse('frontend');
                });
                
                document.getElementById('toggle-backend').addEventListener('click', () => {
                    this.responsiveAdapter.toggleBranchCollapse('backend');
                });
                
                // æ¨¡æ“¬å·¥å…·
                document.getElementById('simulate-mobile').addEventListener('click', () => {
                    this.simulateDevice(375, 667);
                });
                
                document.getElementById('simulate-tablet').addEventListener('click', () => {
                    this.simulateDevice(768, 1024);
                });
                
                document.getElementById('simulate-desktop').addEventListener('click', () => {
                    this.simulateDevice(1200, 800);
                });
                
                document.getElementById('test-performance').addEventListener('click', () => {
                    this.runPerformanceTest();
                });
            }
            
            switchLayout(mode) {
                this.currentMode = mode;
                const layoutConfig = this.responsiveAdapter.config.layouts[mode];
                this.responsiveAdapter.applyLayout(layoutConfig, true);
            }
            
            updateLayoutButtons(activeMode) {
                document.querySelectorAll('.control-group button').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                const modeMap = {
                    'free-drag': 'layout-desktop',
                    'constrained-drag': 'layout-tablet', 
                    'vertical-scroll': 'layout-mobile'
                };
                
                const activeBtn = document.getElementById(modeMap[activeMode]);
                if (activeBtn) {
                    activeBtn.classList.add('active');
                }
            }
            
            simulateDevice(width, height) {
                // èª¿æ•´å®¹å™¨å¤§å°æ¨¡æ“¬ä¸åŒè¨­å‚™
                this.container.style.width = `${width}px`;
                this.container.style.height = `${height}px`;
                this.container.style.margin = '0 auto';
                this.container.style.border = '2px solid var(--primary-gold)';
                
                // è§¸ç™¼ resize äº‹ä»¶
                setTimeout(() => {
                    window.dispatchEvent(new Event('resize'));
                }, 100);
                
                // 5ç§’å¾Œæ¢å¾©
                setTimeout(() => {
                    this.container.style.width = '';
                    this.container.style.height = '';
                    this.container.style.margin = '';
                    this.container.style.border = '';
                    window.dispatchEvent(new Event('resize'));
                }, 5000);
            }
            
            runPerformanceTest() {
                console.log('é–‹å§‹æ•ˆèƒ½æ¸¬è©¦...');
                const startTime = performance.now();
                let frameCount = 0;
                
                // åŸ·è¡Œå¤§é‡æ“ä½œæ¸¬è©¦æ•ˆèƒ½
                const testOperations = () => {
                    frameCount++;
                    
                    // éš¨æ©Ÿç¸®æ”¾å’Œç§»å‹•
                    if (frameCount % 5 === 0) {
                        const randomZoom = Math.random() * 0.1 - 0.05;
                        this.viewportController.zoomAtPoint(
                            Math.random() * this.container.clientWidth,
                            Math.random() * this.container.clientHeight,
                            randomZoom
                        );
                    }
                    
                    if (frameCount < 120) { // 2ç§’æ¸¬è©¦
                        requestAnimationFrame(testOperations);
                    } else {
                        const duration = performance.now() - startTime;
                        const fps = (frameCount / duration) * 1000;
                        console.log(`æ•ˆèƒ½æ¸¬è©¦å®Œæˆ: ${fps.toFixed(1)} FPS (${frameCount} frames in ${duration.toFixed(1)}ms)`);
                        this.stats.frameRate = fps;
                        this.updateStatsDisplay();
                    }
                };
                
                requestAnimationFrame(testOperations);
            }
            
            startStatsUpdate() {
                setInterval(() => {
                    this.updateStatsDisplay();
                }, 1000);
            }
            
            updateStatsDisplay() {
                const deviceInfo = `${this.responsiveAdapter?.device?.type || 'æœªçŸ¥'} (${window.innerWidth}Ã—${window.innerHeight})`;
                const viewportState = this.viewportController?.getViewportState();
                const adapterState = this.responsiveAdapter?.getAdapterState();
                
                document.getElementById('device-info').textContent = `è¨­å‚™: ${deviceInfo}`;
                
                if (viewportState) {
                    document.getElementById('viewport-info').textContent = 
                        `è¦–çª—: ${viewportState.scale.toFixed(2)}x (${Math.round(viewportState.x)}, ${Math.round(viewportState.y)})`;
                }
                
                if (adapterState) {
                    document.getElementById('layout-info').textContent = 
                        `ä½ˆå±€: ${adapterState.currentLayout || 'è¼‰å…¥ä¸­'} (æŠ˜ç–Š: ${adapterState.collapsedBranches?.length || 0})`;
                }
                
                document.getElementById('interaction-info').textContent = 
                    `äº’å‹•: ${this.stats.interactionCount} æ¬¡ (ä½ˆå±€åˆ‡æ›: ${this.stats.layoutSwitchCount})`;
                
                const uptime = Math.floor((Date.now() - this.stats.startTime) / 1000);
                document.getElementById('performance-info').textContent = 
                    `æ•ˆèƒ½: ${this.stats.frameRate.toFixed(1)} FPS (åŸ·è¡Œ: ${uptime}s)`;
            }
        }
        
        // å•Ÿå‹•æ¸¬è©¦
        document.addEventListener('DOMContentLoaded', () => {
            window.responsiveTest = new ResponsiveSkillTreeTest();
        });
    </script>
</body>
</html>
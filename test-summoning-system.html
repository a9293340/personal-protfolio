<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å®Œæ•´éŠæˆ²ç‹å¬å–šç‰¹æ•ˆç³»çµ±æ¸¬è©¦</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
      color: #fff;
      min-height: 100vh;
      overflow: hidden;
    }

    .test-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .control-panel {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 15px;
      z-index: 2000;
      flex-wrap: wrap;
      justify-content: center;
    }

    .test-btn {
      background: linear-gradient(135deg, #d4af37, #f4d03f);
      color: #0a0a0a;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
    }

    .test-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
    }

    .test-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .status-panel {
      position: fixed;
      top: 80px;
      left: 20px;
      display: flex;
      flex-direction: column;
      gap: 15px;
      z-index: 2000;
    }

    .status-card {
      background: rgba(0, 0, 0, 0.7);
      padding: 15px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 12px;
      max-width: 280px;
      border: 1px solid rgba(212, 175, 55, 0.3);
    }

    .status-card h3 {
      color: #d4af37;
      margin-bottom: 10px;
      font-size: 14px;
    }

    .status-item {
      margin: 5px 0;
      display: flex;
      justify-content: space-between;
    }

    .status-value {
      color: #4a90e2;
      font-weight: bold;
    }

    .progress-panel {
      position: fixed;
      top: 80px;
      right: 20px;
      background: rgba(0, 0, 0, 0.7);
      padding: 15px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 12px;
      max-width: 300px;
      border: 1px solid rgba(244, 208, 63, 0.3);
      z-index: 2000;
    }

    .progress-panel h3 {
      color: #f4d03f;
      margin-bottom: 15px;
    }

    .progress-bar {
      width: 250px;
      height: 8px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      margin: 10px 0;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #d4af37, #f4d03f);
      width: 0%;
      transition: width 0.1s ease;
      border-radius: 4px;
    }

    .phase-indicator {
      display: flex;
      justify-content: space-between;
      margin: 15px 0;
      flex-wrap: wrap;
      gap: 5px;
    }

    .phase-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transition: all 0.3s ease;
    }

    .phase-dot.active {
      background: #d4af37;
      box-shadow: 0 0 10px rgba(212, 175, 55, 0.8);
      transform: scale(1.3);
    }

    .phase-dot.completed {
      background: #4a90e2;
    }

    .performance-info {
      background: rgba(26, 26, 46, 0.8);
    }

    .error-display {
      background: rgba(139, 0, 0, 0.8);
      border-color: rgba(139, 0, 0, 0.5);
      display: none;
    }

    .error-display.show {
      display: block;
    }

    #summoning-display {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: visible;
    }

    /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
    @media (max-width: 768px) {
      .control-panel {
        flex-direction: column;
        align-items: center;
        top: 10px;
      }
      
      .status-panel {
        position: relative;
        top: auto;
        left: auto;
        align-items: center;
        margin: 20px;
      }
      
      .progress-panel {
        position: relative;
        top: auto;
        right: auto;
        margin: 20px;
      }
      
      .test-container {
        padding-top: 200px;
      }
    }

    /* å‹•ç•«æ•ˆæœ */
    .status-value.updating {
      animation: pulse 0.5s ease-in-out;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); color: #f4d03f; }
      100% { transform: scale(1); }
    }
  </style>
</head>
<body>
  <div class="test-container">
    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="control-panel">
      <button id="full-summon-btn" class="test-btn">ğŸ® éš¨æ©Ÿå¬å–š</button>
      <button id="legendary-btn" class="test-btn">ğŸ‘‘ å‚³èªªå¡ç‰Œ</button>
      <button id="super-rare-btn" class="test-btn">â­ è¶…ç¨€æœ‰</button>
      <button id="rare-btn" class="test-btn">ğŸ’ ç¨€æœ‰</button>
      <button id="normal-btn" class="test-btn">ğŸ”¹ æ™®é€š</button>
      <button id="quick-test-btn" class="test-btn">âš¡ å¿«é€Ÿæ¸¬è©¦</button>
      <button id="reset-btn" class="test-btn">ğŸ”„ é‡ç½®ç³»çµ±</button>
    </div>

    <!-- ç‹€æ…‹é¢æ¿ -->
    <div class="status-panel">
      <!-- çµ„ä»¶ç‹€æ…‹ -->
      <div class="status-card">
        <h3>ğŸ¯ çµ„ä»¶ç‹€æ…‹</h3>
        <div class="status-item">
          <span>é­”æ³•é™£:</span>
          <span id="magic-circle-status" class="status-value">æœªåˆå§‹åŒ–</span>
        </div>
        <div class="status-item">
          <span>ç²’å­ç³»çµ±:</span>
          <span id="particle-system-status" class="status-value">æœªåˆå§‹åŒ–</span>
        </div>
        <div class="status-item">
          <span>å¡ç‰Œå¬å–š:</span>
          <span id="card-summoning-status" class="status-value">æœªåˆå§‹åŒ–</span>
        </div>
        <div class="status-item">
          <span>å‹•ç•«æ§åˆ¶:</span>
          <span id="animation-controller-status" class="status-value">æœªåˆå§‹åŒ–</span>
        </div>
      </div>

      <!-- ç³»çµ±ç‹€æ…‹ -->
      <div class="status-card performance-info">
        <h3>âš™ï¸ ç³»çµ±ä¿¡æ¯</h3>
        <div class="status-item">
          <span>GSAP:</span>
          <span id="gsap-version" class="status-value">æª¢æŸ¥ä¸­...</span>
        </div>
        <div class="status-item">
          <span>Three.js:</span>
          <span id="threejs-version" class="status-value">æª¢æŸ¥ä¸­...</span>
        </div>
        <div class="status-item">
          <span>è¨­å‚™é¡å‹:</span>
          <span id="device-type" class="status-value">æª¢æ¸¬ä¸­...</span>
        </div>
        <div class="status-item">
          <span>æ€§èƒ½æ¨¡å¼:</span>
          <span id="performance-mode" class="status-value">è‡ªå‹•</span>
        </div>
      </div>

      <!-- éŒ¯èª¤é¡¯ç¤º -->
      <div class="status-card error-display" id="error-display">
        <h3>âŒ éŒ¯èª¤ä¿¡æ¯</h3>
        <div id="error-content"></div>
      </div>
    </div>

    <!-- é€²åº¦é¢æ¿ -->
    <div class="progress-panel">
      <h3>ğŸ¬ å¬å–šé€²åº¦</h3>
      
      <div class="status-item">
        <span>ç¸½é€²åº¦:</span>
        <span id="total-progress" class="status-value">0%</span>
      </div>
      
      <div class="progress-bar">
        <div id="total-progress-fill" class="progress-fill"></div>
      </div>
      
      <div class="status-item">
        <span>ç•¶å‰éšæ®µ:</span>
        <span id="current-phase" class="status-value">å¾…æ©Ÿ</span>
      </div>
      
      <div class="status-item">
        <span>éšæ®µé€²åº¦:</span>
        <span id="phase-progress" class="status-value">0%</span>
      </div>
      
      <div class="progress-bar">
        <div id="phase-progress-fill" class="progress-fill"></div>
      </div>
      
      <!-- éšæ®µæŒ‡ç¤ºå™¨ -->
      <div class="phase-indicator">
        <div class="phase-dot" id="phase-dot-1" title="é­”æ³•é™£å±•é–‹"></div>
        <div class="phase-dot" id="phase-dot-2" title="èƒ½é‡èšé›†"></div>
        <div class="phase-dot" id="phase-dot-3" title="ç²’å­çˆ†ç™¼"></div>
        <div class="phase-dot" id="phase-dot-4" title="å¡ç‰Œå¬å–š"></div>
        <div class="phase-dot" id="phase-dot-5" title="è½‰å ´æº–å‚™"></div>
      </div>

      <div class="status-item">
        <span>å‹•ç•«ç‹€æ…‹:</span>
        <span id="animation-status" class="status-value">åœæ­¢</span>
      </div>
    </div>

    <!-- å¬å–šç‰¹æ•ˆé¡¯ç¤ºå€åŸŸ -->
    <div id="summoning-display"></div>
  </div>

  <!-- è¼‰å…¥åº« -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.159.0/build/three.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

  <!-- æ¸¬è©¦è…³æœ¬ -->
  <script type="module">
    // å°å…¥çµ„ä»¶
    import { BaseComponent } from './src/core/components/BaseComponent.js';
    import { MagicCircle } from './src/components/gaming/SummoningSystem/MagicCircle.js';
    import { ParticleSystem } from './src/components/gaming/SummoningSystem/ParticleSystem.js';
    import { CardSummoning } from './src/components/gaming/SummoningSystem/CardSummoning.js';
    import { AnimationController } from './src/components/gaming/SummoningSystem/AnimationController.js';
    import { AudioManager } from './src/components/gaming/SummoningSystem/AudioManager.js';

    class SummoningSystemTest {
      constructor() {
        this.animationController = null;
        this.components = {
          magicCircle: null,
          particleSystem: null,
          cardSummoning: null,
          audioManager: null
        };
        this.init();
      }

      async init() {
        console.log('ğŸ§ª [SummoningSystemTest] åˆå§‹åŒ–å®Œæ•´å¬å–šç³»çµ±æ¸¬è©¦');
        
        try {
          // ç­‰å¾…åº«è¼‰å…¥
          await this.waitForLibraries();
          
          // é¡¯ç¤ºç³»çµ±ä¿¡æ¯
          this.displaySystemInfo();
          
          // å‰µå»ºå„çµ„ä»¶å¯¦ä¾‹
          await this.createComponents();
          
          // å‰µå»ºå‹•ç•«æ§åˆ¶å™¨
          await this.createAnimationController();
          
          // å‰µå»ºé¡¯ç¤ºå…ƒç´ 
          this.createDisplayElements();
          
          // ç¶å®šæ§åˆ¶äº‹ä»¶
          this.bindEvents();
          
          // é–‹å§‹ç‹€æ…‹ç›£æ§
          this.startStatusMonitoring();
          
          console.log('âœ… [SummoningSystemTest] æ¸¬è©¦ç’°å¢ƒæº–å‚™å®Œæˆ');
          
        } catch (error) {
          console.error('âŒ [SummoningSystemTest] åˆå§‹åŒ–å¤±æ•—:', error);
          this.showError('åˆå§‹åŒ–å¤±æ•—', error);
        }
      }

      // ç­‰å¾…åº«è¼‰å…¥
      async waitForLibraries() {
        const checkLibrary = (lib, name) => {
          return new Promise((resolve, reject) => {
            if (lib) {
              console.log(`âœ… [SummoningSystemTest] ${name} å·²è¼‰å…¥`);
              resolve();
              return;
            }
            
            let attempts = 0;
            const check = () => {
              attempts++;
              if (window[lib] || (lib === 'THREE' && window.THREE)) {
                console.log(`âœ… [SummoningSystemTest] ${name} è¼‰å…¥å®Œæˆ`);
                resolve();
              } else if (attempts > 50) {
                reject(new Error(`${name} è¼‰å…¥è¶…æ™‚`));
              } else {
                setTimeout(check, 100);
              }
            };
            check();
          });
        };

        await Promise.all([
          checkLibrary(window.gsap, 'GSAP'),
          checkLibrary(window.THREE, 'Three.js')
        ]);
      }

      displaySystemInfo() {
        // GSAP ç‰ˆæœ¬
        document.getElementById('gsap-version').textContent = 
          window.gsap ? window.gsap.version : 'Not Loaded';
        
        // Three.js ç‰ˆæœ¬
        document.getElementById('threejs-version').textContent = 
          window.THREE ? 'r159' : 'Not Loaded';
        
        // è¨­å‚™é¡å‹
        const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        document.getElementById('device-type').textContent = isMobile ? 'Mobile' : 'Desktop';
        
        // æ€§èƒ½æ¨¡å¼
        document.getElementById('performance-mode').textContent = 'Auto';
      }

      async createComponents() {
        console.log('ğŸ”§ [SummoningSystemTest] å‰µå»ºçµ„ä»¶å¯¦ä¾‹');
        
        // å‰µå»ºé­”æ³•é™£
        this.components.magicCircle = new MagicCircle({
          circle: { size: 400 },
          position: { x: '50%', y: '50%' }
        });
        
        // å‰µå»ºç²’å­ç³»çµ±
        this.components.particleSystem = new ParticleSystem({
          container: { width: window.innerWidth, height: window.innerHeight }
        });
        
        // å‰µå»ºå¡ç‰Œå¬å–š
        this.components.cardSummoning = new CardSummoning({
          card: { backImageUrl: './src/assets/images/å¡èƒŒ.webp' }
        });
        
        // å‰µå»ºéŸ³æ•ˆç®¡ç†å™¨
        this.components.audioManager = new AudioManager('audio-test-container', {
          enabled: true,
          masterVolume: 0.7,
          enableSummoningSounds: true,
          enableUISounds: true
        });
        
        // æ‰‹å‹•åˆå§‹åŒ–éœ€è¦åˆå§‹åŒ–çš„çµ„ä»¶
        try {
          // ParticleSystem éœ€è¦åˆå§‹åŒ–
          if (this.components.particleSystem.init) {
            await this.components.particleSystem.init();
          }
          
          // CardSummoning éœ€è¦åˆå§‹åŒ–
          if (this.components.cardSummoning.init) {
            await this.components.cardSummoning.init();
          }
          
          // AudioManager éœ€è¦åˆå§‹åŒ–
          if (this.components.audioManager.init) {
            await this.components.audioManager.init();
          }
          
          console.log('âœ… [SummoningSystemTest] çµ„ä»¶åˆå§‹åŒ–å®Œæˆ');
        } catch (error) {
          console.error('âŒ [SummoningSystemTest] çµ„ä»¶åˆå§‹åŒ–å¤±æ•—:', error);
          throw error;
        }
        
        console.log('âœ… [SummoningSystemTest] çµ„ä»¶å¯¦ä¾‹å‰µå»ºå®Œæˆ');
      }

      async createAnimationController() {
        console.log('ğŸ® [SummoningSystemTest] å‰µå»ºå‹•ç•«æ§åˆ¶å™¨');
        
        this.animationController = new AnimationController({
          sequence: {
            totalDuration: 8000,
            phases: {
              magicCircle: { start: 0, duration: 2000, name: 'é­”æ³•é™£å±•é–‹' },
              energyGather: { start: 2000, duration: 1500, name: 'èƒ½é‡èšé›†' },
              particleBurst: { start: 3500, duration: 1000, name: 'ç²’å­çˆ†ç™¼' },
              cardSummoning: { start: 4500, duration: 3500, name: 'å¡ç‰Œå¬å–š' },
              transition: { start: 8000, duration: 500, name: 'è½‰å ´æº–å‚™' }
            }
          }
        });
        
        // åˆå§‹åŒ–å‹•ç•«æ§åˆ¶å™¨
        await this.animationController.init(this.components);
        
        // ç¶å®šäº‹ä»¶
        this.bindAnimationEvents();
        
        console.log('âœ… [SummoningSystemTest] å‹•ç•«æ§åˆ¶å™¨å‰µå»ºå®Œæˆ');
      }

      createDisplayElements() {
        const displayContainer = document.getElementById('summoning-display');
        const controllerElement = this.animationController.createElement();
        displayContainer.appendChild(controllerElement);
      }

      bindAnimationEvents() {
        this.animationController.on('sequenceStart', () => {
          console.log('ğŸ¬ [Test] å¬å–šåºåˆ—é–‹å§‹');
          this.updateAnimationStatus('é‹è¡Œä¸­');
        });
        
        this.animationController.on('phaseChange', ({ phase, config }) => {
          console.log(`ğŸ¯ [Test] éšæ®µè®Šæ›´: ${config.name}`);
          this.updateCurrentPhase(config.name);
          this.updatePhaseIndicator(phase);
        });
        
        this.animationController.on('progressUpdate', ({ total, phase }) => {
          this.updateProgress(total, phase);
        });
        
        this.animationController.on('sequenceComplete', (data) => {
          console.log('âœ… [Test] å¬å–šåºåˆ—å®Œæˆ:', data);
          this.updateAnimationStatus('å®Œæˆ');
        });
        
        this.animationController.on('phaseError', ({ phase, error }) => {
          console.error(`âŒ [Test] éšæ®µéŒ¯èª¤ ${phase}:`, error);
          this.showError(`éšæ®µ ${phase} éŒ¯èª¤`, error);
        });
      }

      bindEvents() {
        const fullSummonBtn = document.getElementById('full-summon-btn');
        const legendaryBtn = document.getElementById('legendary-btn');
        const superRareBtn = document.getElementById('super-rare-btn');
        const rareBtn = document.getElementById('rare-btn');
        const normalBtn = document.getElementById('normal-btn');
        const quickTestBtn = document.getElementById('quick-test-btn');
        const resetBtn = document.getElementById('reset-btn');

        fullSummonBtn.addEventListener('click', async () => {
          console.log('ğŸ® [Test] ç”¨æˆ¶é»æ“Šå®Œæ•´å¬å–šåºåˆ—');
          this.disableAllButtons();
          
          try {
            // ä½¿ç”¨çœŸå¯¦å°ˆæ¡ˆæ•¸æ“šé€²è¡Œæ¸¬è©¦
            const testProjects = [
              { id: 'microservices-ecommerce', name: 'å¾®æœå‹™é›»å•†ç³»çµ±', rarity: 'legendary' },
              { id: 'real-time-chat-system', name: 'å³æ™‚èŠå¤©ç³»çµ±', rarity: 'superRare' },
              { id: 'config-driven-cms', name: 'é…ç½®é©…å‹•CMS', rarity: 'rare' },
              { id: 'task-management-api', name: 'ä»»å‹™ç®¡ç†API', rarity: 'normal' }
            ];
            
            // éš¨æ©Ÿé¸æ“‡ä¸€å€‹å°ˆæ¡ˆé€²è¡Œå¬å–š
            const randomProject = testProjects[Math.floor(Math.random() * testProjects.length)];
            console.log(`ğŸ¯ [Test] å¬å–šå°ˆæ¡ˆ: ${randomProject.name} (${randomProject.rarity})`);
            
            await this.animationController.playSummoningSequence(randomProject);
            console.log('âœ… [Test] å®Œæ•´å¬å–šåºåˆ—å®Œæˆ');
            
            // å»¶é²é‡ç½®ï¼Œè®“å¡ç‰Œå±•ç¤ºæœ‰æ™‚é–“å®Œæˆ (ç¾åœ¨æ˜¯10ç§’å‹•ç•«)
            console.log('â³ [Test] ç­‰å¾…å®Œæ•´å¡ç‰Œå±•ç¤ºå®Œæˆ...');
            await this.delay(3000); // ç­‰å¾…3ç§’è®“å»¶é•·å±•ç¤ºéšæ®µå®Œæˆ
            
            // ä½¿ç”¨è»Ÿé‡ç½®ä¿æŒå¡ç‰Œé¡¯ç¤º
            console.log('ğŸ”§ [Test] åŸ·è¡Œè»Ÿé‡ç½®ä¿æŒå¡ç‰Œé¡¯ç¤º');
            this.animationController.softReset();
            
          } catch (error) {
            console.error('å¬å–šåºåˆ—å¤±æ•—:', error);
            this.showError('å¬å–šåºåˆ—å¤±æ•—', error);
          } finally {
            this.enableAllButtons();
          }
        });

        // ç¨€æœ‰åº¦ç‰¹å®šå¬å–šäº‹ä»¶
        const rarityProjects = {
          legendary: [
            { id: 'microservices-ecommerce', name: 'å¾®æœå‹™é›»å•†ç³»çµ±', rarity: 'legendary' }
          ],
          superRare: [
            { id: 'real-time-chat-system', name: 'å³æ™‚èŠå¤©ç³»çµ±', rarity: 'superRare' }
          ],
          rare: [
            { id: 'config-driven-cms', name: 'é…ç½®é©…å‹•CMS', rarity: 'rare' }
          ],
          normal: [
            { id: 'task-management-api', name: 'ä»»å‹™ç®¡ç†API', rarity: 'normal' }
          ]
        };

        const createRarityHandler = (rarity) => {
          return async () => {
            console.log(`ğŸ¯ [Test] ç”¨æˆ¶é»æ“Š ${rarity} å¡ç‰Œå¬å–š`);
            this.disableAllButtons();
            
            try {
              const projects = rarityProjects[rarity];
              const randomProject = projects[Math.floor(Math.random() * projects.length)];
              console.log(`âœ¨ [Test] å¬å–š ${rarity} å°ˆæ¡ˆ: ${randomProject.name}`);
              
              await this.animationController.playSummoningSequence(randomProject);
              console.log(`âœ… [Test] ${rarity} å¡ç‰Œå¬å–šå®Œæˆ`);
              
              // å»¶é²é‡ç½®ï¼Œè®“å¡ç‰Œå±•ç¤ºæœ‰æ™‚é–“å®Œæˆï¼ˆç­‰å¾…å®Œæ•´å‹•ç•«ï¼‰
              console.log(`â³ [Test] ç­‰å¾… ${rarity} å¡ç‰Œå®Œæ•´å±•ç¤º...`);
              await this.delay(3000); // ç­‰å¾…3ç§’è®“å»¶é•·å±•ç¤ºéšæ®µå®Œæˆ
              
              // ä½¿ç”¨è»Ÿé‡ç½®ä¿æŒå¡ç‰Œé¡¯ç¤º
              console.log(`ğŸ”§ [Test] åŸ·è¡Œè»Ÿé‡ç½®ä¿æŒå¡ç‰Œé¡¯ç¤º`);
              this.animationController.softReset();
              
            } catch (error) {
              console.error(`âŒ [Test] ${rarity} å¬å–šå¤±æ•—:`, error);
              this.showError(`${rarity} å¬å–šå¤±æ•—`, error);
            } finally {
              this.enableAllButtons();
            }
          };
        };

        legendaryBtn.addEventListener('click', createRarityHandler('legendary'));
        superRareBtn.addEventListener('click', createRarityHandler('superRare'));
        rareBtn.addEventListener('click', createRarityHandler('rare'));
        normalBtn.addEventListener('click', createRarityHandler('normal'));

        quickTestBtn.addEventListener('click', async () => {
          console.log('âš¡ [Test] ç”¨æˆ¶é»æ“Šå¿«é€Ÿæ¸¬è©¦');
          this.disableAllButtons();
          
          // è‡¨æ™‚ä¿®æ”¹ç‚ºå¿«é€Ÿæ¨¡å¼
          const originalDuration = this.animationController.config.sequence.totalDuration;
          this.animationController.config.sequence.totalDuration = 3000;
          
          try {
            const testProject = { id: 'quick-test', name: 'å¿«é€Ÿæ¸¬è©¦', rarity: 'normal' };
            await this.animationController.playSummoningSequence(testProject);
            
            // å³ä½¿æ˜¯å¿«é€Ÿæ¸¬è©¦ä¹Ÿè¦ç­‰å¾…åŸºæœ¬å±•ç¤º
            console.log('â³ [Test] å¿«é€Ÿæ¸¬è©¦ç­‰å¾…åŸºæœ¬å±•ç¤º...');
            await this.delay(2000); // å¿«é€Ÿæ¸¬è©¦ç­‰2ç§’çœ‹åˆ°ç¿»è½‰æ•ˆæœ
            
            // ä½¿ç”¨è»Ÿé‡ç½®ä¿æŒå¡ç‰Œé¡¯ç¤º
            console.log('ğŸ”§ [Test] å¿«é€Ÿæ¸¬è©¦è»Ÿé‡ç½®');
            this.animationController.softReset();
            
          } catch (error) {
            console.error('å¿«é€Ÿæ¸¬è©¦å¤±æ•—:', error);
            this.showError('å¿«é€Ÿæ¸¬è©¦å¤±æ•—', error);
          } finally {
            // æ¢å¾©åŸå§‹æ™‚é•·
            this.animationController.config.sequence.totalDuration = originalDuration;
            this.enableAllButtons();
          }
        });

        resetBtn.addEventListener('click', () => {
          console.log('ğŸ”„ [Test] ç”¨æˆ¶é»æ“Šé‡ç½®ç³»çµ±');
          this.animationController.reset();
          this.resetUI();
          this.enableAllButtons();
        });
      }

      delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
      }

      updateProgress(total, phase) {
        const totalPercent = Math.round(total * 100);
        const phasePercent = Math.round(phase * 100);
        
        document.getElementById('total-progress').textContent = `${totalPercent}%`;
        document.getElementById('total-progress-fill').style.width = `${totalPercent}%`;
        document.getElementById('phase-progress').textContent = `${phasePercent}%`;
        document.getElementById('phase-progress-fill').style.width = `${phasePercent}%`;
      }

      updateCurrentPhase(phaseName) {
        const element = document.getElementById('current-phase');
        element.textContent = phaseName;
        element.classList.add('updating');
        setTimeout(() => element.classList.remove('updating'), 500);
      }

      updatePhaseIndicator(currentPhase) {
        const phases = ['magicCircle', 'energyGather', 'particleBurst', 'cardSummoning', 'transition'];
        const currentIndex = phases.indexOf(currentPhase);
        
        phases.forEach((phase, index) => {
          const dot = document.getElementById(`phase-dot-${index + 1}`);
          if (index < currentIndex) {
            dot.className = 'phase-dot completed';
          } else if (index === currentIndex) {
            dot.className = 'phase-dot active';
          } else {
            dot.className = 'phase-dot';
          }
        });
      }

      updateAnimationStatus(status) {
        document.getElementById('animation-status').textContent = status;
      }

      disableAllButtons() {
        document.querySelectorAll('.test-btn').forEach(btn => btn.disabled = true);
      }

      enableAllButtons() {
        document.querySelectorAll('.test-btn').forEach(btn => btn.disabled = false);
      }

      resetUI() {
        this.updateProgress(0, 0);
        this.updateCurrentPhase('å¾…æ©Ÿ');
        this.updateAnimationStatus('åœæ­¢');
        document.querySelectorAll('.phase-dot').forEach(dot => dot.className = 'phase-dot');
        this.hideError();
      }

      showError(title, error) {
        const errorDisplay = document.getElementById('error-display');
        const errorContent = document.getElementById('error-content');
        errorContent.innerHTML = `
          <div style="margin-bottom: 10px; font-weight: bold;">${title}</div>
          <div style="font-size: 11px; color: #ff6b6b;">${error.message || error}</div>
        `;
        errorDisplay.classList.add('show');
      }

      hideError() {
        document.getElementById('error-display').classList.remove('show');
      }

      startStatusMonitoring() {
        setInterval(() => {
          // æ›´æ–°çµ„ä»¶ç‹€æ…‹
          this.updateComponentStatus('magic-circle-status', this.components.magicCircle);
          this.updateComponentStatus('particle-system-status', this.components.particleSystem);
          this.updateComponentStatus('card-summoning-status', this.components.cardSummoning);
          
          // æ›´æ–°å‹•ç•«æ§åˆ¶å™¨ç‹€æ…‹
          if (this.animationController) {
            const status = this.animationController.isAnimating ? 'é‹è¡Œä¸­' : 'å°±ç·’';
            document.getElementById('animation-controller-status').textContent = status;
          }
        }, 500);
      }

      updateComponentStatus(elementId, component) {
        const element = document.getElementById(elementId);
        if (!component) {
          element.textContent = 'æœªå‰µå»º';
          return;
        }
        
        const status = component.isAnimating ? 'å‹•ç•«ä¸­' : 
                      component.state?.isVisible ? 'é¡¯ç¤ºä¸­' : 'å°±ç·’';
        element.textContent = status;
      }
    }

    // ç­‰å¾…é é¢è¼‰å…¥å®Œæˆå¾Œå•Ÿå‹•æ¸¬è©¦
    document.addEventListener('DOMContentLoaded', () => {
      new SummoningSystemTest();
    });
  </script>
</body>
</html>
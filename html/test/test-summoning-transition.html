<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Step 2.3.3 - å¬å–šåˆ°è©³æƒ…é ç„¡ç¸«è½‰å ´æ¸¬è©¦</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .test-container {
            max-width: 1400px;
            margin: 0 auto;
            text-align: center;
        }

        .test-header h1 {
            font-size: 2.5em;
            background: linear-gradient(45deg, #d4af37, #f4d03f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(212, 175, 55, 0.5);
        }

        .test-header p {
            font-size: 1.2em;
            color: #a0a0a0;
            margin-bottom: 30px;
        }

        .controls {
            margin: 30px 0;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4a90e2, #357abd);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(74, 144, 226, 0.4);
        }

        .btn-legendary {
            background: linear-gradient(135deg, #d4af37, #f4d03f);
            color: #1a1a2e;
            position: relative;
            overflow: hidden;
        }

        .btn-legendary::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: rotate(45deg);
            transition: all 0.5s;
            opacity: 0;
        }

        .btn-legendary:hover::before {
            animation: shimmer 0.5s ease;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); opacity: 0; }
        }

        .timeline-showcase {
            margin: 40px 0;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-height: 500px;
        }

        .test-instructions {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }

        .test-instructions h3 {
            color: #4a90e2;
            margin-top: 0;
        }

        .test-instructions ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .test-instructions li {
            margin: 8px 0;
            line-height: 1.6;
        }

        .device-info {
            background: rgba(74, 144, 226, 0.1);
            border: 1px solid rgba(74, 144, 226, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }

        .device-info h4 {
            margin-top: 0;
            color: #64b5f6;
        }

        .device-profile {
            font-family: monospace;
            color: #81c784;
            font-size: 1.2em;
        }

        .loading-message {
            text-align: center;
            padding: 60px 20px;
            font-size: 1.2em;
            opacity: 0.7;
        }

        /* å¬å–šå‹•ç•«æ¨£å¼ */
        .summoning-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.85);
            pointer-events: auto;
        }

        .skip-hint {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 10px 15px;
            font-size: 14px;
            z-index: 10001;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .phase-indicator {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(212, 175, 55, 0.5);
            border-radius: 20px;
            padding: 10px 20px;
            font-size: 14px;
            z-index: 10001;
        }

        .phase-name {
            color: #d4af37;
            font-weight: bold;
        }

        .phase-timer {
            color: #a0a0a0;
            margin-left: 10px;
        }
    </style>
    
    <!-- GSAP CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>ğŸ® Step 2.3.3 å¬å–šè½‰å ´æ¸¬è©¦</h1>
            <p>éŠæˆ²ç‹å¬å–šå‹•ç•«åˆ°è©³æƒ…é ç„¡ç¸«è½‰å ´ç³»çµ±</p>
        </div>

        <div class="device-info">
            <h4>âš™ï¸ è¨­å‚™æª¢æ¸¬</h4>
            <p>ç•¶å‰è¨­å‚™é¡å‹: <span class="device-profile" id="deviceProfile">æª¢æ¸¬ä¸­...</span></p>
            <p>WebGL æ”¯æ´: <span id="webglSupport">æª¢æ¸¬ä¸­...</span></p>
            <p>é æœŸæ•ˆèƒ½ç­‰ç´š: <span id="performanceLevel">æª¢æ¸¬ä¸­...</span></p>
        </div>

        <div class="controls">
            <button class="btn btn-primary" onclick="initializeTimeline()">
                ğŸš€ åˆå§‹åŒ–æ™‚é–“è»¸ç³»çµ±
            </button>
            <button class="btn btn-legendary" onclick="testLegendarySummoning()">
                â­ æ¸¬è©¦å‚³èªªç´šå¬å–š
            </button>
            <button class="btn btn-primary" onclick="testNormalCard()">
                ğŸ“‹ æ¸¬è©¦æ™®é€šå¡ç‰‡
            </button>
            <button class="btn btn-primary" onclick="testLowEndDevice()">
                ğŸ“± æ¨¡æ“¬ä½ç«¯è¨­å‚™
            </button>
        </div>

        <div class="test-instructions">
            <h3>ğŸ§ª æ¸¬è©¦æ­¥é©Ÿ</h3>
            <ul>
                <li><strong>åˆå§‹åŒ–æ™‚é–“è»¸:</strong> è¼‰å…¥äº’å‹•æ™‚é–“è»¸ï¼Œå•Ÿç”¨å¬å–šç³»çµ±</li>
                <li><strong>é»æ“Šå‚³èªªç´šå°ˆæ¡ˆ:</strong> è§¸ç™¼å®Œæ•´ 8 ç§’å¬å–šå‹•ç•«åºåˆ—</li>
                <li><strong>é»æ“Šæ™®é€šå°ˆæ¡ˆ:</strong> ç›´æ¥é¡¯ç¤ºè©³æƒ…æ¨¡æ…‹æ¡†ï¼ˆç„¡å¬å–šï¼‰</li>
                <li><strong>æŒ‰ ESC éµ:</strong> è·³éå¬å–šå‹•ç•«ï¼Œç›´æ¥é¡¯ç¤ºæ¨¡æ…‹æ¡†</li>
                <li><strong>é»æ“ŠèƒŒæ™¯:</strong> ä¹Ÿå¯è·³éå¬å–šå‹•ç•«</li>
            </ul>
            
            <h3>ğŸ“Š å‹•ç•«æ™‚åº (8ç§’)</h3>
            <ul>
                <li><strong>Phase 1 (0-2s):</strong> é­”æ³•é™£å±•é–‹</li>
                <li><strong>Phase 2 (2-3.5s):</strong> èƒ½é‡èšé›†</li>
                <li><strong>Phase 3 (3.5-4.5s):</strong> ç²’å­çˆ†ç™¼</li>
                <li><strong>Phase 4 (4.5-6.5s):</strong> å¡ç‰Œé¡¯ç¾</li>
                <li><strong>Phase 5 (6.5-7s):</strong> è½‰å ´æº–å‚™</li>
                <li><strong>Phase 6 (7-8s):</strong> æ¨¡æ…‹æ¡†åˆ‡æ›</li>
            </ul>

            <h3>âœ… é æœŸæ•ˆæœ</h3>
            <ul>
                <li>å‚³èªªç´šå°ˆæ¡ˆè§¸ç™¼è¯éº—å¬å–šå‹•ç•«</li>
                <li>å‹•ç•«çµæŸå¾Œç„¡ç¸«åˆ‡æ›åˆ°è©³æƒ…é </li>
                <li>ESC éµå¯éš¨æ™‚è·³éå‹•ç•«</li>
                <li>ä½ç«¯è¨­å‚™è‡ªå‹•é™ç´šåˆ°ç°¡åŒ–ç‰ˆæœ¬</li>
                <li>ç§»å‹•ç«¯ç²’å­æ•¸é‡è‡ªå‹•æ¸›å°‘</li>
            </ul>
        </div>

        <div id="loading" class="loading-message" style="display: none;">
            â³ æ­£åœ¨è¼‰å…¥å¬å–šè½‰å ´ç³»çµ±...
        </div>

        <div id="timelineShowcase" class="timeline-showcase">
            <div id="timelineContainer">
                <!-- äº’å‹•æ™‚é–“è»¸å°‡åœ¨æ­¤é¡¯ç¤º -->
            </div>
        </div>
    </div>

    <script type="module">
        import { InteractiveTimeline } from '../../src/components/gaming/InteractiveTimeline/InteractiveTimeline.js';
        import { SummoningTransition } from '../../src/components/gaming/SummoningSystem/SummoningTransition.js';

        window.InteractiveTimeline = InteractiveTimeline;
        window.SummoningTransition = SummoningTransition;
        window.timelineInstance = null;
        window.summoningInstance = null;

        // æ¸¬è©¦ç”¨å°ˆæ¡ˆæ•¸æ“š
        const testProjects = [
            {
                id: 'legendary-project-1',
                title: 'ğŸŒŸ AI èŠå¤©æ©Ÿå™¨äººæ¶æ§‹',
                date: '2024-01',
                description: 'ä¼æ¥­ç´š AI æ™ºèƒ½å®¢æœç³»çµ±',
                category: 'ai',
                importance: 10,
                rarity: 'legendary',
                status: 'current',
                cardData: {
                    attack: 3000,
                    defense: 2500,
                    level: 10,
                    attribute: 'LIGHT',
                    type: 'AI/Effect'
                }
            },
            {
                id: 'legendary-project-2',
                title: 'âš¡ é›²ç«¯å¾®æœå‹™æ¶æ§‹',
                date: '2023-06',
                description: 'ç™¾è¬ç´šä¸¦ç™¼è™•ç†ç³»çµ±',
                category: 'cloud',
                importance: 9,
                rarity: 'legendary',
                status: 'past',
                cardData: {
                    attack: 2800,
                    defense: 2600,
                    level: 9,
                    attribute: 'WIND',
                    type: 'Cloud/Synchro'
                }
            },
            {
                id: 'rare-project-1',
                title: 'React é›»å•†å¹³å°',
                date: '2023-03',
                description: 'B2C é›»å•†ç¶²ç«™é–‹ç™¼',
                category: 'frontend',
                importance: 7,
                rarity: 'rare',
                status: 'past'
            },
            {
                id: 'normal-project-1',
                title: 'API æ–‡æª”ç³»çµ±',
                date: '2022-11',
                description: 'RESTful API æ–‡æª”ç”Ÿæˆ',
                category: 'backend',
                importance: 5,
                rarity: 'normal',
                status: 'past'
            },
            {
                id: 'normal-project-2',
                title: 'éƒ¨è½æ ¼ç¶²ç«™',
                date: '2022-06',
                description: 'å€‹äººæŠ€è¡“éƒ¨è½æ ¼',
                category: 'fullstack',
                importance: 4,
                rarity: 'normal',
                status: 'past'
            }
        ];

        // è¨­å‚™æª¢æ¸¬
        function detectDevice() {
            const summoningTransition = new SummoningTransition();
            const profile = summoningTransition.deviceProfile;
            const hasWebGL = summoningTransition.checkWebGLSupport();
            
            document.getElementById('deviceProfile').textContent = profile;
            document.getElementById('webglSupport').textContent = hasWebGL ? 'âœ… æ”¯æ´' : 'âŒ ä¸æ”¯æ´';
            
            const performanceMap = {
                'desktop': 'ğŸš€ é«˜æ•ˆèƒ½ (å®Œæ•´ç‰¹æ•ˆ)',
                'mobile': 'ğŸ“± ä¸­ç­‰ (å„ªåŒ–ç‰¹æ•ˆ)',
                'lowEnd': 'ğŸ”‹ ç¯€èƒ½ (ç°¡åŒ–ç‰¹æ•ˆ)'
            };
            document.getElementById('performanceLevel').textContent = performanceMap[profile] || 'æœªçŸ¥';
            
            return profile;
        }

        // åˆå§‹åŒ–æ™‚é–“è»¸
        window.initializeTimeline = async function() {
            try {
                const loadingEl = document.getElementById('loading');
                const containerEl = document.getElementById('timelineContainer');
                
                loadingEl.style.display = 'block';
                
                if (window.timelineInstance) {
                    window.timelineInstance.destroy();
                    window.timelineInstance = null;
                }
                
                containerEl.innerHTML = '';
                
                console.log('ğŸ® é–‹å§‹å‰µå»ºå¬å–šè½‰å ´æ¸¬è©¦æ™‚é–“è»¸');
                
                // å‰µå»ºæ™‚é–“è»¸ï¼Œå•Ÿç”¨å¬å–šç³»çµ±
                window.timelineInstance = new InteractiveTimeline({
                    container: containerEl,
                    projects: testProjects,
                    height: '450px',
                    summoning: {
                        enabled: true  // å•Ÿç”¨å¬å–šç³»çµ±
                    }
                });
                
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                const timelineElement = window.timelineInstance.getElement();
                if (timelineElement) {
                    containerEl.appendChild(timelineElement);
                    window.timelineInstance.setupAfterMount();
                    
                    loadingEl.style.display = 'none';
                    
                    console.log('âœ… å¬å–šè½‰å ´æ™‚é–“è»¸åˆå§‹åŒ–å®Œæˆ');
                    alert('æ™‚é–“è»¸å·²åˆå§‹åŒ–ï¼é»æ“Šé‡‘è‰²çš„å‚³èªªç´šå°ˆæ¡ˆç¯€é»è§¸ç™¼å¬å–šå‹•ç•«');
                } else {
                    throw new Error('æ™‚é–“è»¸å…ƒç´ å‰µå»ºå¤±æ•—');
                }
                
            } catch (error) {
                console.error('âŒ æ™‚é–“è»¸åˆå§‹åŒ–å¤±æ•—:', error);
                document.getElementById('loading').innerHTML = 
                    `<div style="color: #e74c3c;">âŒ åˆå§‹åŒ–å¤±æ•—: ${error.message}</div>`;
            }
        };

        // æ¸¬è©¦å‚³èªªç´šå¬å–š
        window.testLegendarySummoning = async function() {
            console.log('â­ æ¸¬è©¦å‚³èªªç´šå¬å–šå‹•ç•«');
            
            const legendaryProject = testProjects[0];
            const mockElement = document.createElement('div');
            mockElement.style.cssText = 'position: fixed; left: 50%; top: 50%; width: 50px; height: 50px; background: gold; border-radius: 50%;';
            document.body.appendChild(mockElement);
            
            // é¡¯ç¤ºè·³éæç¤º
            const skipHint = document.createElement('div');
            skipHint.className = 'skip-hint';
            skipHint.innerHTML = 'æŒ‰ <strong>ESC</strong> éµè·³éå‹•ç•«';
            document.body.appendChild(skipHint);
            
            // é¡¯ç¤ºéšæ®µæŒ‡ç¤ºå™¨
            const phaseIndicator = document.createElement('div');
            phaseIndicator.className = 'phase-indicator';
            phaseIndicator.innerHTML = '<span class="phase-name">æº–å‚™ä¸­</span><span class="phase-timer">0.0s</span>';
            document.body.appendChild(phaseIndicator);
            
            try {
                window.summoningInstance = new SummoningTransition({
                    animation: {
                        skipEnabled: true,
                        skipKey: 'Escape'
                    }
                });
                
                // ç›£è½éšæ®µè®ŠåŒ–
                let startTime = performance.now();
                const updatePhase = setInterval(() => {
                    if (window.summoningInstance) {
                        const elapsed = ((performance.now() - startTime) / 1000).toFixed(1);
                        const phase = window.summoningInstance.currentPhase;
                        const phaseNames = {
                            'idle': 'æº–å‚™ä¸­',
                            'magicCircle': 'Phase 1: é­”æ³•é™£å±•é–‹',
                            'energyGather': 'Phase 2: èƒ½é‡èšé›†',
                            'particleBurst': 'Phase 3: ç²’å­çˆ†ç™¼',
                            'cardReveal': 'Phase 4: å¡ç‰Œé¡¯ç¾',
                            'transition': 'Phase 5: è½‰å ´æº–å‚™',
                            'modalSwitch': 'Phase 6: æ¨¡æ…‹æ¡†åˆ‡æ›'
                        };
                        phaseIndicator.innerHTML = `<span class="phase-name">${phaseNames[phase] || phase}</span><span class="phase-timer">${elapsed}s</span>`;
                    }
                }, 100);
                
                await window.summoningInstance.startTransition(legendaryProject, mockElement);
                
                clearInterval(updatePhase);
                
            } finally {
                mockElement.remove();
                skipHint.remove();
                phaseIndicator.remove();
            }
        };

        // æ¸¬è©¦æ™®é€šå¡ç‰‡
        window.testNormalCard = async function() {
            console.log('ğŸ“‹ æ¸¬è©¦æ™®é€šå¡ç‰‡ï¼ˆç„¡å¬å–šï¼‰');
            
            const normalProject = testProjects[3];
            const mockElement = document.createElement('div');
            
            // ç›´æ¥é¡¯ç¤ºæ¨¡æ…‹æ¡†
            const { ProjectCardModal } = await import('../../src/components/gaming/InteractiveTimeline/ProjectCardModal.js');
            const modal = new ProjectCardModal();
            await modal.show(normalProject, mockElement);
        };

        // æ¨¡æ“¬ä½ç«¯è¨­å‚™
        window.testLowEndDevice = async function() {
            console.log('ğŸ“± æ¨¡æ“¬ä½ç«¯è¨­å‚™');
            
            // è‡¨æ™‚è¦†è“‹è¨­å‚™æª¢æ¸¬
            const originalDetect = SummoningTransition.prototype.detectDeviceProfile;
            SummoningTransition.prototype.detectDeviceProfile = function() {
                return 'lowEnd';
            };
            
            await testLegendarySummoning();
            
            // æ¢å¾©åŸå§‹æª¢æ¸¬
            SummoningTransition.prototype.detectDeviceProfile = originalDetect;
        };

        // é é¢è¼‰å…¥å®Œæˆå¾Œæª¢æ¸¬è¨­å‚™
        document.addEventListener('DOMContentLoaded', () => {
            detectDevice();
            console.log('ğŸ® å¬å–šè½‰å ´æ¸¬è©¦é é¢å·²å°±ç·’');
        });
    </script>
</body>
</html>
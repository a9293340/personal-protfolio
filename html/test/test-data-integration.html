<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ Step 2.2.5c - æ•¸æ“šç®¡ç†ç³»çµ±æ•´åˆæ¸¬è©¦</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #0a0a0a, #1a1a2e);
            color: #ffffff;
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
        }
        
        .test-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-title {
            text-align: center;
            margin-bottom: 40px;
            color: #d4af37;
            border-bottom: 2px solid rgba(212, 175, 55, 0.3);
            padding-bottom: 20px;
        }
        
        .test-section {
            margin-bottom: 40px;
            padding: 25px;
            background: rgba(26, 26, 46, 0.8);
            border-radius: 15px;
            border: 1px solid rgba(212, 175, 55, 0.3);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }
        
        .test-section h3 {
            margin-top: 0;
            color: #f4d03f;
            border-bottom: 1px solid rgba(244, 208, 63, 0.2);
            padding-bottom: 10px;
        }
        
        .data-integration-demo {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 20px 0;
        }
        
        .timeline-container {
            grid-column: 1 / -1;
            height: 600px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            border: 2px solid rgba(212, 175, 55, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .data-stats {
            background: rgba(0, 0, 0, 0.4);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid rgba(212, 175, 55, 0.2);
        }
        
        .layout-stats {
            background: rgba(26, 46, 26, 0.6);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }
        
        .test-controls {
            margin: 25px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .test-controls button {
            padding: 12px 20px;
            background: linear-gradient(135deg, #d4af37, #f4d03f);
            color: #000;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
        }
        
        .test-controls button:hover {
            background: linear-gradient(135deg, #f4d03f, #ffeb3b);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(212, 175, 55, 0.4);
        }
        
        .test-controls button:active {
            transform: translateY(0);
        }
        
        .test-controls button.secondary {
            background: linear-gradient(135deg, #45b7d1, #5dade2);
        }
        
        .test-controls button.danger {
            background: linear-gradient(135deg, #e74c3c, #ec7063);
            color: white;
        }
        
        .log-area {
            height: 200px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 6px;
            padding: 15px;
            font-family: 'Fira Code', monospace;
            font-size: 12px;
            border: 1px solid rgba(212, 175, 55, 0.2);
            line-height: 1.5;
        }
        
        .log-entry {
            margin-bottom: 8px;
            opacity: 0;
            animation: fadeIn 0.3s ease forwards;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .log-timestamp {
            color: #95a5a6;
            margin-right: 10px;
        }
        
        .log-success { color: #2ecc71; }
        .log-error { color: #e74c3c; }
        .log-warning { color: #f39c12; }
        .log-info { color: #3498db; }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 6px;
            border-left: 4px solid #d4af37;
        }
        
        .stat-label {
            font-size: 12px;
            color: #bdc3c7;
            margin-bottom: 4px;
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #ffffff;
        }
        
        .filter-controls {
            background: rgba(52, 73, 94, 0.4);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid rgba(52, 152, 219, 0.3);
            margin: 20px 0;
        }
        
        .filter-group {
            margin-bottom: 15px;
        }
        
        .filter-group label {
            display: block;
            color: #ecf0f1;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .filter-group select,
        .filter-group input {
            width: 100%;
            padding: 8px 12px;
            background: rgba(44, 62, 80, 0.8);
            border: 1px solid rgba(149, 165, 166, 0.3);
            border-radius: 4px;
            color: #ffffff;
            font-size: 14px;
        }
        
        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: #3498db;
            background: rgba(44, 62, 80, 1);
        }
        
        .performance-metrics {
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.2), rgba(142, 68, 173, 0.2));
            border: 1px solid rgba(155, 89, 182, 0.3);
        }
        
        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .data-integration-demo {
                grid-template-columns: 1fr;
            }
            
            .test-controls {
                justify-content: center;
            }
            
            .timeline-container {
                height: 400px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* è¼‰å…¥å‹•ç•« */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #d4af37;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
    
    <!-- GSAP CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/Draggable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/MotionPathPlugin.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
</head>
<body>
    <div class="test-container">
        <h1 class="test-title">ğŸš€ Step 2.2.5c - æ•¸æ“šç®¡ç†ç³»çµ±æ•´åˆæ¸¬è©¦</h1>
        
        <div class="test-section">
            <h3>ğŸ“Š æ•¸æ“šé©é…å™¨ (DataAdapter) æ¸¬è©¦</h3>
            <div class="test-controls">
                <button onclick="testDataAdapter()">è¼‰å…¥çœŸå¯¦å°ˆæ¡ˆæ•¸æ“š</button>
                <button onclick="testDataFiltering()" class="secondary">æ¸¬è©¦æ•¸æ“šç¯©é¸</button>
                <button onclick="showDataStatistics()" class="secondary">é¡¯ç¤ºæ•¸æ“šçµ±è¨ˆ</button>
                <button onclick="clearDataAdapter()" class="danger">æ¸…é™¤æ•¸æ“š</button>
            </div>
            <div class="data-stats" id="data-stats">
                <div class="stat-label">ç­‰å¾…è¼‰å…¥æ•¸æ“š...</div>
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ§® æ™ºèƒ½ä½ˆå±€å¼•æ“ (TimelineLayoutEngine) æ¸¬è©¦</h3>
            <div class="test-controls">
                <button onclick="testLayoutEngine()">è¨ˆç®—æ™ºèƒ½ä½ˆå±€</button>
                <button onclick="changeLayoutStrategy('adaptive')" class="secondary">è‡ªé©æ‡‰ä½ˆå±€</button>
                <button onclick="changeLayoutStrategy('importance')" class="secondary">é‡è¦æ€§ä½ˆå±€</button>
                <button onclick="changeLayoutStrategy('spiral')" class="secondary">èºæ—‹ä½ˆå±€</button>
                <button onclick="showLayoutStatistics()" class="secondary">ä½ˆå±€çµ±è¨ˆ</button>
            </div>
            <div class="layout-stats" id="layout-stats">
                <div class="stat-label">ç­‰å¾…ä½ˆå±€è¨ˆç®—...</div>
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ¯ é‡è¦æ€§è©•åˆ†ç³»çµ± (ImportanceScoring) æ¸¬è©¦</h3>
            <div class="test-controls">
                <button onclick="testImportanceScoring()">è¨ˆç®—é‡è¦æ€§è©•åˆ†</button>
                <button onclick="showScoringBreakdown()" class="secondary">è©•åˆ†æ˜ç´°</button>
                <button onclick="testScoringStrategies()" class="secondary">æ¸¬è©¦ä¸åŒç­–ç•¥</button>
                <button onclick="showIndustryComparison()" class="secondary">è¡Œæ¥­å°æ¯”</button>
            </div>
            <div class="data-stats" id="scoring-stats">
                <div class="stat-label">ç­‰å¾…è©•åˆ†è¨ˆç®—...</div>
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ”§ ç¯©é¸å’Œæœç´¢æ¸¬è©¦</h3>
            <div class="filter-controls">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div class="filter-group">
                        <label for="category-filter">å°ˆæ¡ˆé¡åˆ¥ç¯©é¸</label>
                        <select id="category-filter" multiple>
                            <option value="backend">å¾Œç«¯ç³»çµ±</option>
                            <option value="architecture">ç³»çµ±æ¶æ§‹</option>
                            <option value="fullstack">å…¨ç«¯é–‹ç™¼</option>
                            <option value="opensource">é–‹æºå°ˆæ¡ˆ</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="rarity-filter">ç¨€æœ‰åº¦ç¯©é¸</label>
                        <select id="rarity-filter" multiple>
                            <option value="normal">æ™®é€š</option>
                            <option value="rare">ç¨€æœ‰</option>
                            <option value="superRare">è¶…ç¨€æœ‰</option>
                            <option value="legendary">å‚³èªª</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="year-filter">æ™‚é–“ç¯„åœ</label>
                        <input type="range" id="year-range" min="2020" max="2025" value="2023">
                        <span id="year-display">2023</span>
                    </div>
                </div>
            </div>
            <div class="test-controls">
                <button onclick="applyFilters()">æ‡‰ç”¨ç¯©é¸</button>
                <button onclick="clearFilters()" class="secondary">æ¸…é™¤ç¯©é¸</button>
                <button onclick="testAdvancedSearch()" class="secondary">é«˜ç´šæœç´¢</button>
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ® å®Œæ•´æ™‚é–“è»¸æ•´åˆæ¸¬è©¦</h3>
            <div class="test-controls">
                <button onclick="initializeFullTimeline()">ğŸš€ åˆå§‹åŒ–å®Œæ•´æ™‚é–“è»¸</button>
                <button onclick="testResponsiveLayout()" class="secondary">ğŸ“± éŸ¿æ‡‰å¼æ¸¬è©¦</button>
                <button onclick="testInteractiveFeatures()" class="secondary">âš¡ äº’å‹•åŠŸèƒ½æ¸¬è©¦</button>
                <button onclick="measurePerformance()" class="secondary">ğŸ“ˆ æ€§èƒ½æ¸¬è©¦</button>
                <button onclick="resetTimeline()" class="danger">é‡ç½®æ™‚é–“è»¸</button>
            </div>
            <div class="timeline-container" id="timeline-container">
                <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #bdc3c7; font-size: 16px;">
                    <span>é»æ“Š "åˆå§‹åŒ–å®Œæ•´æ™‚é–“è»¸" é–‹å§‹æ¸¬è©¦</span>
                </div>
            </div>
            <div class="data-integration-demo">
                <div class="performance-metrics" id="performance-metrics">
                    <h4 style="margin-top: 0; color: #bb86fc;">ğŸ“ˆ æ€§èƒ½æŒ‡æ¨™</h4>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">åˆå§‹åŒ–æ™‚é–“</div>
                            <div class="stat-value" id="init-time">-</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ä½ˆå±€è¨ˆç®—æ™‚é–“</div>
                            <div class="stat-value" id="layout-time">-</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">æ¸²æŸ“æ™‚é–“</div>
                            <div class="stat-value" id="render-time">-</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">è¨˜æ†¶é«”ä½¿ç”¨</div>
                            <div class="stat-value" id="memory-usage">-</div>
                        </div>
                    </div>
                </div>
                <div class="data-stats">
                    <h4 style="margin-top: 0; color: #4fc3f7;">ğŸ“Š æ•¸æ“šæ¦‚æ³</h4>
                    <div class="stats-grid" id="data-overview">
                        <div class="stat-item">
                            <div class="stat-label">è¼‰å…¥å°ˆæ¡ˆæ•¸</div>
                            <div class="stat-value" id="project-count">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">å¹³å‡é‡è¦æ€§</div>
                            <div class="stat-value" id="avg-importance">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ä½ˆå±€ç¯€é»æ•¸</div>
                            <div class="stat-value" id="layout-nodes">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ç¢°æ’è§£æ±ºæ•¸</div>
                            <div class="stat-value" id="collisions">0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“ æ¸¬è©¦æ—¥èªŒ</h3>
            <div class="test-controls">
                <button onclick="clearLog()" class="danger">æ¸…é™¤æ—¥èªŒ</button>
                <button onclick="exportTestResults()" class="secondary">å°å‡ºçµæœ</button>
            </div>
            <div class="log-area" id="log-area"></div>
        </div>
    </div>

    <script type="module">
        // å°å…¥çµ„ä»¶
        import { DataAdapter } from '../../src/components/gaming/InteractiveTimeline/DataAdapter.js';
        import { TimelineLayoutEngine } from '../../src/components/gaming/InteractiveTimeline/TimelineLayoutEngine.js';
        import { ImportanceScoring } from '../../src/components/gaming/InteractiveTimeline/ImportanceScoring.js';
        import { InteractiveTimeline } from '../../src/components/gaming/InteractiveTimeline/InteractiveTimeline.js';
        
        // å…¨åŸŸè®Šæ•¸
        window.testComponents = {
            dataAdapter: null,
            layoutEngine: null,
            importanceScoring: null,
            interactiveTimeline: null
        };
        
        window.testData = {
            projects: [],
            adaptedProjects: [],
            layoutNodes: [],
            performanceMetrics: {}
        };
        
        // å…ˆå®šç¾©æ—¥èªŒå‡½æ•¸
        window.log = function(message, type = 'info') {
            const logArea = document.getElementById('log-area');
            if (!logArea) {
                console.log(`[${type.toUpperCase()}] ${message}`);
                return;
            }
            
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-message">${message}</span>
            `;
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
            
            console.log(`[${type.toUpperCase()}] ${message}`);
        };
        
        // è¼‰å…¥å°ˆæ¡ˆæ•¸æ“š
        let projectsDataConfig = null;
        
        try {
            const projectsModule = await import('./src/config/data/projects.data.js');
            projectsDataConfig = projectsModule.projectsDataConfig || projectsModule.default;
            log('âœ… æˆåŠŸè¼‰å…¥çœŸå¯¦å°ˆæ¡ˆæ•¸æ“šé…ç½®', 'success');
        } catch (error) {
            log('âš ï¸ ç„¡æ³•è¼‰å…¥çœŸå¯¦å°ˆæ¡ˆæ•¸æ“šï¼Œå°‡ä½¿ç”¨æ¸¬è©¦æ•¸æ“š: ' + error.message, 'warning');
            projectsDataConfig = createTestData();
        }
        
        window.projectsDataConfig = projectsDataConfig;
        
        function createTestData() {
            return {
                all: {
                    'test-backend': {
                        id: 'test-backend',
                        name: 'æ¸¬è©¦å¾Œç«¯ç³»çµ±',
                        rarity: 'rare',
                        category: 'backend',
                        shortDescription: 'æ¸¬è©¦ç”¨çš„å¾Œç«¯ç³»çµ±å°ˆæ¡ˆ',
                        timeline: { startDate: '2023-01', endDate: '2023-08', status: 'completed' },
                        stats: { complexity: 7, innovation: 6, utility: 8 },
                        technologies: [
                            { name: 'Node.js', category: 'backend' },
                            { name: 'PostgreSQL', category: 'database' }
                        ]
                    },
                    'test-frontend': {
                        id: 'test-frontend',
                        name: 'æ¸¬è©¦å‰ç«¯æ‡‰ç”¨',
                        rarity: 'normal',
                        category: 'frontend',
                        shortDescription: 'æ¸¬è©¦ç”¨çš„å‰ç«¯æ‡‰ç”¨å°ˆæ¡ˆ',
                        timeline: { startDate: '2024-01', endDate: '2024-06', status: 'completed' },
                        stats: { complexity: 5, innovation: 4, utility: 6 },
                        technologies: [
                            { name: 'React', category: 'frontend' },
                            { name: 'TypeScript', category: 'language' }
                        ]
                    }
                }
            };
        }
        
        // å°å‡ºæ¸¬è©¦å‡½æ•¸åˆ°å…¨åŸŸ
        window.DataAdapter = DataAdapter;
        window.TimelineLayoutEngine = TimelineLayoutEngine;
        window.ImportanceScoring = ImportanceScoring;
        window.InteractiveTimeline = InteractiveTimeline;
        
        log('ğŸš€ æ•¸æ“šç®¡ç†ç³»çµ±æ•´åˆæ¸¬è©¦é é¢å·²è¼‰å…¥', 'success');
        log('ğŸ“š å¯ç”¨çµ„ä»¶: DataAdapter, TimelineLayoutEngine, ImportanceScoring, InteractiveTimeline', 'info');
        
        // è¨­ç½®å¹´ä»½ç¯„åœæ»‘å‹•æ¢äº‹ä»¶
        const yearRange = document.getElementById('year-range');
        const yearDisplay = document.getElementById('year-display');
        yearRange.addEventListener('input', (e) => {
            yearDisplay.textContent = e.target.value;
        });
    </script>

    <script>
        // æ¸¬è©¦å‡½æ•¸
        async function testDataAdapter() {
            log('ğŸ”§ é–‹å§‹æ¸¬è©¦ DataAdapter...', 'info');
            
            try {
                // åˆå§‹åŒ– DataAdapter
                window.testComponents.dataAdapter = new DataAdapter({
                    timeline: { minYear: 2020, maxYear: 2025 },
                    importanceWeights: {
                        complexity: 0.3,
                        innovation: 0.3,
                        utility: 0.2,
                        rarity: 0.2
                    }
                });
                
                // è¼‰å…¥ä¸¦é©é…æ•¸æ“š
                const startTime = performance.now();
                window.testData.adaptedProjects = await window.testComponents.dataAdapter.loadProjectsData(window.projectsDataConfig);
                const endTime = performance.now();
                
                log(`âœ… DataAdapter æ¸¬è©¦æˆåŠŸï¼Œè¼‰å…¥ ${window.testData.adaptedProjects.length} å€‹å°ˆæ¡ˆ`, 'success');
                log(`â±ï¸ æ•¸æ“šé©é…è€—æ™‚: ${(endTime - startTime).toFixed(2)}ms`, 'info');
                
                // æ›´æ–°çµ±è¨ˆé¡¯ç¤º
                updateDataStatistics();
                
            } catch (error) {
                log(`âŒ DataAdapter æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
                console.error('DataAdapter test error:', error);
            }
        }
        
        async function testLayoutEngine() {
            log('ğŸ§® é–‹å§‹æ¸¬è©¦ TimelineLayoutEngine...', 'info');
            
            if (!window.testData.adaptedProjects || window.testData.adaptedProjects.length === 0) {
                log('âš ï¸ è«‹å…ˆåŸ·è¡Œ DataAdapter æ¸¬è©¦è¼‰å…¥å°ˆæ¡ˆæ•¸æ“š', 'warning');
                return;
            }
            
            try {
                // åˆå§‹åŒ– LayoutEngine
                window.testComponents.layoutEngine = new TimelineLayoutEngine({
                    layout: {
                        timelineHeight: 500,
                        timelineWidth: 1000,
                        type: 'adaptive'
                    }
                });
                
                // è¨ˆç®—ä½ˆå±€
                const startTime = performance.now();
                window.testData.layoutNodes = window.testComponents.layoutEngine.calculateLayout(
                    window.testData.adaptedProjects,
                    { width: 1000, height: 500 }
                );
                const endTime = performance.now();
                
                log(`âœ… LayoutEngine æ¸¬è©¦æˆåŠŸï¼Œè¨ˆç®— ${window.testData.layoutNodes.length} å€‹ç¯€é»ä½ˆå±€`, 'success');
                log(`â±ï¸ ä½ˆå±€è¨ˆç®—è€—æ™‚: ${(endTime - startTime).toFixed(2)}ms`, 'info');
                
                // æ›´æ–°ä½ˆå±€çµ±è¨ˆ
                updateLayoutStatistics();
                
            } catch (error) {
                log(`âŒ LayoutEngine æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
                console.error('LayoutEngine test error:', error);
            }
        }
        
        async function testImportanceScoring() {
            log('ğŸ¯ é–‹å§‹æ¸¬è©¦ ImportanceScoring...', 'info');
            
            if (!window.testData.adaptedProjects || window.testData.adaptedProjects.length === 0) {
                log('âš ï¸ è«‹å…ˆåŸ·è¡Œ DataAdapter æ¸¬è©¦è¼‰å…¥å°ˆæ¡ˆæ•¸æ“š', 'warning');
                return;
            }
            
            try {
                // åˆå§‹åŒ– ImportanceScoring
                window.testComponents.importanceScoring = new ImportanceScoring();
                
                // å°æ‰€æœ‰å°ˆæ¡ˆé€²è¡Œè©•åˆ†
                const startTime = performance.now();
                let totalScore = 0;
                let scoringResults = [];
                
                for (const project of window.testData.adaptedProjects) {
                    const result = window.testComponents.importanceScoring.calculateImportanceScore(
                        project.originalData || project,
                        { careerStage: 'mid' }
                    );
                    totalScore += result.finalScore;
                    scoringResults.push(result);
                }
                
                const endTime = performance.now();
                const avgScore = totalScore / window.testData.adaptedProjects.length;
                
                log(`âœ… ImportanceScoring æ¸¬è©¦æˆåŠŸï¼Œå¹³å‡è©•åˆ†: ${avgScore.toFixed(2)}/10`, 'success');
                log(`â±ï¸ è©•åˆ†è¨ˆç®—è€—æ™‚: ${(endTime - startTime).toFixed(2)}ms`, 'info');
                
                // æ›´æ–°è©•åˆ†çµ±è¨ˆ
                updateScoringStatistics(scoringResults);
                
            } catch (error) {
                log(`âŒ ImportanceScoring æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
                console.error('ImportanceScoring test error:', error);
            }
        }
        
        async function initializeFullTimeline() {
            log('ğŸš€ é–‹å§‹åˆå§‹åŒ–å®Œæ•´æ™‚é–“è»¸ç³»çµ±...', 'info');
            
            const container = document.getElementById('timeline-container');
            container.innerHTML = '<div class="loading"></div> æ­£åœ¨åˆå§‹åŒ–æ™‚é–“è»¸ç³»çµ±...';
            
            try {
                const startTime = performance.now();
                
                // åˆå§‹åŒ– InteractiveTimeline
                window.testComponents.interactiveTimeline = new InteractiveTimeline({
                    container: container,
                    width: '100%',
                    height: '600px'
                });
                
                const endTime = performance.now();
                window.testData.performanceMetrics.initTime = endTime - startTime;
                
                log(`âœ… å®Œæ•´æ™‚é–“è»¸ç³»çµ±åˆå§‹åŒ–æˆåŠŸ`, 'success');
                log(`â±ï¸ åˆå§‹åŒ–è€—æ™‚: ${window.testData.performanceMetrics.initTime.toFixed(2)}ms`, 'info');
                
                // æ›´æ–°æ€§èƒ½æŒ‡æ¨™
                updatePerformanceMetrics();
                
            } catch (error) {
                log(`âŒ æ™‚é–“è»¸åˆå§‹åŒ–å¤±æ•—: ${error.message}`, 'error');
                console.error('Timeline initialization error:', error);
                container.innerHTML = `<div style="color: #e74c3c; padding: 20px; text-align: center;">åˆå§‹åŒ–å¤±æ•—: ${error.message}</div>`;
            }
        }
        
        function updateDataStatistics() {
            const stats = window.testComponents.dataAdapter?.getDataStatistics();
            if (!stats) return;
            
            const statsContainer = document.getElementById('data-stats');
            statsContainer.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">ç¸½å°ˆæ¡ˆæ•¸</div>
                        <div class="stat-value">${stats.totalProjects}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">å¹³å‡é‡è¦æ€§</div>
                        <div class="stat-value">${stats.importanceStats.average}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">æ™‚é–“ç¯„åœ</div>
                        <div class="stat-value">${stats.timeRange.earliest}-${stats.timeRange.latest}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">ç¨€æœ‰åº¦åˆ†ä½ˆ</div>
                        <div class="stat-value">L:${stats.byRarity.legendary || 0} SR:${stats.byRarity.superRare || 0} R:${stats.byRarity.rare || 0} N:${stats.byRarity.normal || 0}</div>
                    </div>
                </div>
            `;
            
            // æ›´æ–°æ•´é«”æ•¸æ“šæ¦‚æ³
            document.getElementById('project-count').textContent = stats.totalProjects;
            document.getElementById('avg-importance').textContent = stats.importanceStats.average;
        }
        
        function updateLayoutStatistics() {
            const stats = window.testComponents.layoutEngine?.getLayoutStatistics();
            if (!stats) return;
            
            const statsContainer = document.getElementById('layout-stats');
            statsContainer.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">ä½ˆå±€ç¯€é»æ•¸</div>
                        <div class="stat-value">${stats.totalNodes}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">ç¢°æ’ç¯€é»æ•¸</div>
                        <div class="stat-value">${stats.collisions}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">å¹³å‡èª¿æ•´æ¬¡æ•¸</div>
                        <div class="stat-value">${stats.averageIterations}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">ä¸­å¿ƒå¸¶ç¯€é»</div>
                        <div class="stat-value">${stats.positionDistribution.centerBand}</div>
                    </div>
                </div>
            `;
            
            // æ›´æ–°æ•´é«”ä½ˆå±€æŒ‡æ¨™
            document.getElementById('layout-nodes').textContent = stats.totalNodes;
            document.getElementById('collisions').textContent = stats.collisions;
        }
        
        function updateScoringStatistics(results) {
            const avgScore = results.reduce((sum, r) => sum + r.finalScore, 0) / results.length;
            const maxScore = Math.max(...results.map(r => r.finalScore));
            const minScore = Math.min(...results.map(r => r.finalScore));
            
            const statsContainer = document.getElementById('scoring-stats');
            statsContainer.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">å¹³å‡è©•åˆ†</div>
                        <div class="stat-value">${avgScore.toFixed(2)}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">æœ€é«˜è©•åˆ†</div>
                        <div class="stat-value">${maxScore.toFixed(2)}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">æœ€ä½è©•åˆ†</div>
                        <div class="stat-value">${minScore.toFixed(2)}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">è©•åˆ†ç¯„åœ</div>
                        <div class="stat-value">${(maxScore - minScore).toFixed(2)}</div>
                    </div>
                </div>
            `;
        }
        
        function updatePerformanceMetrics() {
            const metrics = window.testData.performanceMetrics;
            
            if (metrics.initTime) {
                document.getElementById('init-time').textContent = metrics.initTime.toFixed(2) + 'ms';
            }
            if (metrics.layoutTime) {
                document.getElementById('layout-time').textContent = metrics.layoutTime.toFixed(2) + 'ms';
            }
            if (metrics.renderTime) {
                document.getElementById('render-time').textContent = metrics.renderTime.toFixed(2) + 'ms';
            }
            
            // è¨˜æ†¶é«”ä½¿ç”¨é‡ (å¦‚æœå¯ç”¨)
            if (performance.memory) {
                const memoryMB = (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(1);
                document.getElementById('memory-usage').textContent = memoryMB + 'MB';
            }
        }
        
        // å…¶ä»–æ¸¬è©¦å‡½æ•¸
        function testDataFiltering() {
            log('ğŸ” æ¸¬è©¦æ•¸æ“šç¯©é¸åŠŸèƒ½...', 'info');
            
            if (!window.testComponents.dataAdapter) {
                log('âš ï¸ è«‹å…ˆè¼‰å…¥ DataAdapter', 'warning');
                return;
            }
            
            try {
                // æ¸¬è©¦é¡åˆ¥ç¯©é¸
                const backendProjects = window.testComponents.dataAdapter.applyFilters({
                    categories: ['backend']
                });
                log(`âœ… å¾Œç«¯å°ˆæ¡ˆç¯©é¸: ${backendProjects.length} å€‹å°ˆæ¡ˆ`, 'success');
                
                // æ¸¬è©¦ç¨€æœ‰åº¦ç¯©é¸
                const legendaryProjects = window.testComponents.dataAdapter.applyFilters({
                    rarities: ['legendary']
                });
                log(`âœ… å‚³èªªå°ˆæ¡ˆç¯©é¸: ${legendaryProjects.length} å€‹å°ˆæ¡ˆ`, 'success');
                
            } catch (error) {
                log(`âŒ ç¯©é¸æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
            }
        }
        
        function showDataStatistics() {
            const stats = window.testComponents.dataAdapter?.getDataStatistics();
            if (stats) {
                log('ğŸ“Š æ•¸æ“šçµ±è¨ˆ: ' + JSON.stringify(stats, null, 2), 'info');
            } else {
                log('âš ï¸ è«‹å…ˆè¼‰å…¥æ•¸æ“š', 'warning');
            }
        }
        
        function showLayoutStatistics() {
            const stats = window.testComponents.layoutEngine?.getLayoutStatistics();
            if (stats) {
                log('ğŸ“Š ä½ˆå±€çµ±è¨ˆ: ' + JSON.stringify(stats, null, 2), 'info');
            } else {
                log('âš ï¸ è«‹å…ˆè¨ˆç®—ä½ˆå±€', 'warning');
            }
        }
        
        function showScoringBreakdown() {
            log('ğŸ¯ é¡¯ç¤ºè©•åˆ†æ˜ç´°...', 'info');
            if (!window.testComponents.importanceScoring) {
                log('âš ï¸ è«‹å…ˆåŸ·è¡Œé‡è¦æ€§è©•åˆ†æ¸¬è©¦', 'warning');
                return;
            }
            
            const stats = window.testComponents.importanceScoring.getScoringStatistics();
            if (stats) {
                log('ğŸ“Š è©•åˆ†çµ±è¨ˆ: ' + JSON.stringify(stats, null, 2), 'info');
            } else {
                log('âš ï¸ å°šç„¡è©•åˆ†çµ±è¨ˆè³‡æ–™', 'warning');
            }
        }
        
        function testScoringStrategies() {
            log('ğŸ§ª æ¸¬è©¦ä¸åŒè©•åˆ†ç­–ç•¥...', 'info');
            // å¯¦ç¾ä¸åŒç­–ç•¥æ¸¬è©¦
        }
        
        function showIndustryComparison() {
            log('ğŸ­ é¡¯ç¤ºè¡Œæ¥­å°æ¯”...', 'info');
            // å¯¦ç¾è¡Œæ¥­å°æ¯”é¡¯ç¤º
        }
        
        function applyFilters() {
            log('ğŸ” æ‡‰ç”¨ç¯©é¸æ¢ä»¶...', 'info');
            
            const categoryFilter = document.getElementById('category-filter');
            const rarityFilter = document.getElementById('rarity-filter');
            const yearRange = document.getElementById('year-range');
            
            const filters = {
                categories: Array.from(categoryFilter.selectedOptions).map(opt => opt.value),
                rarities: Array.from(rarityFilter.selectedOptions).map(opt => opt.value),
                dateRange: yearRange.value ? {
                    start: `${yearRange.value}-01`,
                    end: `${yearRange.value}-12`
                } : null
            };
            
            log('ç¯©é¸æ¢ä»¶: ' + JSON.stringify(filters), 'info');
            
            if (window.testComponents.dataAdapter) {
                try {
                    const filteredProjects = window.testComponents.dataAdapter.applyFilters(filters);
                    log(`âœ… ç¯©é¸å®Œæˆï¼Œå‰©é¤˜ ${filteredProjects.length} å€‹å°ˆæ¡ˆ`, 'success');
                } catch (error) {
                    log(`âŒ ç¯©é¸å¤±æ•—: ${error.message}`, 'error');
                }
            }
        }
        
        function clearFilters() {
            log('ğŸ§¹ æ¸…é™¤æ‰€æœ‰ç¯©é¸æ¢ä»¶...', 'info');
            
            document.getElementById('category-filter').selectedIndex = -1;
            document.getElementById('rarity-filter').selectedIndex = -1;
            document.getElementById('year-range').value = '2023';
            document.getElementById('year-display').textContent = '2023';
            
            if (window.testComponents.dataAdapter) {
                window.testComponents.dataAdapter.clearFilters();
                log('âœ… ç¯©é¸æ¢ä»¶å·²æ¸…é™¤', 'success');
            }
        }
        
        function testAdvancedSearch() {
            log('ğŸ” æ¸¬è©¦é«˜ç´šæœç´¢åŠŸèƒ½...', 'info');
            // å¯¦ç¾é«˜ç´šæœç´¢åŠŸèƒ½
        }
        
        function testResponsiveLayout() {
            log('ğŸ“± æ¸¬è©¦éŸ¿æ‡‰å¼ä½ˆå±€...', 'info');
            
            if (!window.testComponents.layoutEngine) {
                log('âš ï¸ è«‹å…ˆåˆå§‹åŒ–ä½ˆå±€å¼•æ“', 'warning');
                return;
            }
            
            // æ¨¡æ“¬ä¸åŒå±å¹•å°ºå¯¸
            const viewports = [
                { width: 375, height: 667, name: 'Mobile' },
                { width: 768, height: 1024, name: 'Tablet' },
                { width: 1920, height: 1080, name: 'Desktop' }
            ];
            
            viewports.forEach(viewport => {
                window.testComponents.layoutEngine.updateViewport(viewport);
                log(`ğŸ“± ${viewport.name} ä½ˆå±€æ¸¬è©¦ (${viewport.width}x${viewport.height})`, 'info');
            });
        }
        
        function testInteractiveFeatures() {
            log('âš¡ æ¸¬è©¦äº’å‹•åŠŸèƒ½...', 'info');
            
            if (!window.testComponents.interactiveTimeline) {
                log('âš ï¸ è«‹å…ˆåˆå§‹åŒ–å®Œæ•´æ™‚é–“è»¸', 'warning');
                return;
            }
            
            log('âœ… äº’å‹•åŠŸèƒ½æ¸¬è©¦å®Œæˆ', 'success');
        }
        
        function changeLayoutStrategy(strategy) {
            log(`ğŸ”„ åˆ‡æ›ä½ˆå±€ç­–ç•¥åˆ°: ${strategy}`, 'info');
            if (window.testComponents.layoutEngine) {
                window.testComponents.layoutEngine.config.layout.type = strategy;
                window.testComponents.layoutEngine.clearCache();
                testLayoutEngine();
            }
        }
        
        function clearLog() {
            document.getElementById('log-area').innerHTML = '';
        }
        
        function resetTimeline() {
            log('ğŸ”„ é‡ç½®æ™‚é–“è»¸ç³»çµ±...', 'warning');
            
            // æ¸…ç†æ‰€æœ‰çµ„ä»¶
            Object.keys(window.testComponents).forEach(key => {
                if (window.testComponents[key] && typeof window.testComponents[key].destroy === 'function') {
                    window.testComponents[key].destroy();
                }
                window.testComponents[key] = null;
            });
            
            // æ¸…ç†æ•¸æ“š
            window.testData = {
                projects: [],
                adaptedProjects: [],
                layoutNodes: [],
                performanceMetrics: {}
            };
            
            // é‡ç½® UI
            document.getElementById('timeline-container').innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #bdc3c7; font-size: 16px;">
                    <span>é»æ“Š "åˆå§‹åŒ–å®Œæ•´æ™‚é–“è»¸" é–‹å§‹æ¸¬è©¦</span>
                </div>
            `;
            
            log('âœ… æ™‚é–“è»¸ç³»çµ±å·²é‡ç½®', 'success');
        }
        
        function measurePerformance() {
            log('ğŸ“ˆ é–‹å§‹æ€§èƒ½æ¸¬è©¦...', 'info');
            
            if (!window.testComponents.interactiveTimeline) {
                log('âš ï¸ è«‹å…ˆåˆå§‹åŒ–æ™‚é–“è»¸ç³»çµ±', 'warning');
                return;
            }
            
            const startTime = performance.now();
            
            // åŸ·è¡Œä¸€ç³»åˆ—æ€§èƒ½æ¸¬è©¦
            setTimeout(() => {
                const endTime = performance.now();
                window.testData.performanceMetrics.totalTime = endTime - startTime;
                
                log(`ğŸ“Š æ€§èƒ½æ¸¬è©¦å®Œæˆï¼Œç¸½è€—æ™‚: ${window.testData.performanceMetrics.totalTime.toFixed(2)}ms`, 'success');
                updatePerformanceMetrics();
            }, 100);
        }
        
        function exportTestResults() {
            const results = {
                timestamp: new Date().toISOString(),
                components: Object.keys(window.testComponents).filter(key => window.testComponents[key] !== null),
                dataStats: window.testComponents.dataAdapter?.getDataStatistics(),
                layoutStats: window.testComponents.layoutEngine?.getLayoutStatistics(),
                performanceMetrics: window.testData.performanceMetrics,
                projectCount: window.testData.adaptedProjects.length
            };
            
            const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `timeline-test-results-${new Date().getTime()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            log('ğŸ“¥ æ¸¬è©¦çµæœå·²å°å‡º', 'success');
        }
    </script>
</body>
</html>